
import numpy as np
from scipy.integrate import ode
from numpy import exp
        
STATE_COUNT = 100
VARIABLE_COUNT = 126
PARAMETER_COUNT = 700

# PHS matrices
J = np.zeros((100,100))
R = np.zeros((100,100))
Q = np.zeros((100,100))
Einv = np.zeros((100,100))
B = np.zeros((100,100))
Bhat = np.zeros((100,1))
C = np.zeros((100,100))

#Partition matrices
Jr = np.zeros((100,20))
Rr = np.zeros((100,20))
Qr = np.zeros((100,20))
Er = np.zeros((100,20))
Br = np.zeros((100,20))
Cr = np.zeros((100,20))
Bhatr = np.zeros((100,20))
Ict = np.zeros((100,20)) #For initial condition
R2F = np.zeros((100,20)) #For converting reduced states to full states
        
def Heaviside(x):
    if x > 0:
        return 1.0
    return 0.0
    
def Abs(x):
    return np.fabs(x)    
    
def create_states_array():
    return np.zeros(STATE_COUNT)

def create_variables_array():
    return np.zeros(VARIABLE_COUNT)

def setReductionParameters(parameters):
    Jr[0,0] = parameters[0]
    Jr[1,1] = parameters[1]
    Jr[2,2] = parameters[2]
    Jr[3,3] = parameters[3]
    Jr[4,4] = parameters[4]
    Jr[5,5] = parameters[5]
    Jr[6,6] = parameters[6]
    Jr[7,7] = parameters[7]
    Jr[8,8] = parameters[8]
    Jr[9,9] = parameters[9]
    Jr[10,10] = parameters[10]
    Jr[11,11] = parameters[11]
    Jr[12,12] = parameters[12]
    Jr[13,13] = parameters[13]
    Jr[14,14] = parameters[14]
    Jr[15,15] = parameters[15]
    Jr[16,16] = parameters[16]
    Jr[17,17] = parameters[17]
    Jr[18,18] = parameters[18]
    Jr[19,19] = parameters[19]
    Jr[20,0] = parameters[20]
    Jr[21,1] = parameters[21]
    Jr[22,2] = parameters[22]
    Jr[23,3] = parameters[23]
    Jr[24,4] = parameters[24]
    Jr[25,5] = parameters[25]
    Jr[26,6] = parameters[26]
    Jr[27,7] = parameters[27]
    Jr[28,8] = parameters[28]
    Jr[29,9] = parameters[29]
    Jr[30,10] = parameters[30]
    Jr[31,11] = parameters[31]
    Jr[32,12] = parameters[32]
    Jr[33,13] = parameters[33]
    Jr[34,14] = parameters[34]
    Jr[35,15] = parameters[35]
    Jr[36,16] = parameters[36]
    Jr[37,17] = parameters[37]
    Jr[38,18] = parameters[38]
    Jr[39,19] = parameters[39]
    Jr[40,0] = parameters[40]
    Jr[41,1] = parameters[41]
    Jr[42,2] = parameters[42]
    Jr[43,3] = parameters[43]
    Jr[44,4] = parameters[44]
    Jr[45,5] = parameters[45]
    Jr[46,6] = parameters[46]
    Jr[47,7] = parameters[47]
    Jr[48,8] = parameters[48]
    Jr[49,9] = parameters[49]
    Jr[50,10] = parameters[50]
    Jr[51,11] = parameters[51]
    Jr[52,12] = parameters[52]
    Jr[53,13] = parameters[53]
    Jr[54,14] = parameters[54]
    Jr[55,15] = parameters[55]
    Jr[56,16] = parameters[56]
    Jr[57,17] = parameters[57]
    Jr[58,18] = parameters[58]
    Jr[59,19] = parameters[59]
    Jr[60,0] = parameters[60]
    Jr[61,1] = parameters[61]
    Jr[62,2] = parameters[62]
    Jr[63,3] = parameters[63]
    Jr[64,4] = parameters[64]
    Jr[65,5] = parameters[65]
    Jr[66,6] = parameters[66]
    Jr[67,7] = parameters[67]
    Jr[68,8] = parameters[68]
    Jr[69,9] = parameters[69]
    Jr[70,10] = parameters[70]
    Jr[71,11] = parameters[71]
    Jr[72,12] = parameters[72]
    Jr[73,13] = parameters[73]
    Jr[74,14] = parameters[74]
    Jr[75,15] = parameters[75]
    Jr[76,16] = parameters[76]
    Jr[77,17] = parameters[77]
    Jr[78,18] = parameters[78]
    Jr[79,19] = parameters[79]
    Jr[80,0] = parameters[80]
    Jr[81,1] = parameters[81]
    Jr[82,2] = parameters[82]
    Jr[83,3] = parameters[83]
    Jr[84,4] = parameters[84]
    Jr[85,5] = parameters[85]
    Jr[86,6] = parameters[86]
    Jr[87,7] = parameters[87]
    Jr[88,8] = parameters[88]
    Jr[89,9] = parameters[89]
    Jr[90,10] = parameters[90]
    Jr[91,11] = parameters[91]
    Jr[92,12] = parameters[92]
    Jr[93,13] = parameters[93]
    Jr[94,14] = parameters[94]
    Jr[95,15] = parameters[95]
    Jr[96,16] = parameters[96]
    Jr[97,17] = parameters[97]
    Jr[98,18] = parameters[98]
    Jr[99,19] = parameters[99]
    Rr[0,0] = parameters[100]
    Rr[1,1] = parameters[101]
    Rr[2,2] = parameters[102]
    Rr[3,3] = parameters[103]
    Rr[4,4] = parameters[104]
    Rr[5,5] = parameters[105]
    Rr[6,6] = parameters[106]
    Rr[7,7] = parameters[107]
    Rr[8,8] = parameters[108]
    Rr[9,9] = parameters[109]
    Rr[10,10] = parameters[110]
    Rr[11,11] = parameters[111]
    Rr[12,12] = parameters[112]
    Rr[13,13] = parameters[113]
    Rr[14,14] = parameters[114]
    Rr[15,15] = parameters[115]
    Rr[16,16] = parameters[116]
    Rr[17,17] = parameters[117]
    Rr[18,18] = parameters[118]
    Rr[19,19] = parameters[119]
    Rr[20,0] = parameters[120]
    Rr[21,1] = parameters[121]
    Rr[22,2] = parameters[122]
    Rr[23,3] = parameters[123]
    Rr[24,4] = parameters[124]
    Rr[25,5] = parameters[125]
    Rr[26,6] = parameters[126]
    Rr[27,7] = parameters[127]
    Rr[28,8] = parameters[128]
    Rr[29,9] = parameters[129]
    Rr[30,10] = parameters[130]
    Rr[31,11] = parameters[131]
    Rr[32,12] = parameters[132]
    Rr[33,13] = parameters[133]
    Rr[34,14] = parameters[134]
    Rr[35,15] = parameters[135]
    Rr[36,16] = parameters[136]
    Rr[37,17] = parameters[137]
    Rr[38,18] = parameters[138]
    Rr[39,19] = parameters[139]
    Rr[40,0] = parameters[140]
    Rr[41,1] = parameters[141]
    Rr[42,2] = parameters[142]
    Rr[43,3] = parameters[143]
    Rr[44,4] = parameters[144]
    Rr[45,5] = parameters[145]
    Rr[46,6] = parameters[146]
    Rr[47,7] = parameters[147]
    Rr[48,8] = parameters[148]
    Rr[49,9] = parameters[149]
    Rr[50,10] = parameters[150]
    Rr[51,11] = parameters[151]
    Rr[52,12] = parameters[152]
    Rr[53,13] = parameters[153]
    Rr[54,14] = parameters[154]
    Rr[55,15] = parameters[155]
    Rr[56,16] = parameters[156]
    Rr[57,17] = parameters[157]
    Rr[58,18] = parameters[158]
    Rr[59,19] = parameters[159]
    Rr[60,0] = parameters[160]
    Rr[61,1] = parameters[161]
    Rr[62,2] = parameters[162]
    Rr[63,3] = parameters[163]
    Rr[64,4] = parameters[164]
    Rr[65,5] = parameters[165]
    Rr[66,6] = parameters[166]
    Rr[67,7] = parameters[167]
    Rr[68,8] = parameters[168]
    Rr[69,9] = parameters[169]
    Rr[70,10] = parameters[170]
    Rr[71,11] = parameters[171]
    Rr[72,12] = parameters[172]
    Rr[73,13] = parameters[173]
    Rr[74,14] = parameters[174]
    Rr[75,15] = parameters[175]
    Rr[76,16] = parameters[176]
    Rr[77,17] = parameters[177]
    Rr[78,18] = parameters[178]
    Rr[79,19] = parameters[179]
    Rr[80,0] = parameters[180]
    Rr[81,1] = parameters[181]
    Rr[82,2] = parameters[182]
    Rr[83,3] = parameters[183]
    Rr[84,4] = parameters[184]
    Rr[85,5] = parameters[185]
    Rr[86,6] = parameters[186]
    Rr[87,7] = parameters[187]
    Rr[88,8] = parameters[188]
    Rr[89,9] = parameters[189]
    Rr[90,10] = parameters[190]
    Rr[91,11] = parameters[191]
    Rr[92,12] = parameters[192]
    Rr[93,13] = parameters[193]
    Rr[94,14] = parameters[194]
    Rr[95,15] = parameters[195]
    Rr[96,16] = parameters[196]
    Rr[97,17] = parameters[197]
    Rr[98,18] = parameters[198]
    Rr[99,19] = parameters[199]
    Qr[0,0] = parameters[200]
    Qr[1,1] = parameters[201]
    Qr[2,2] = parameters[202]
    Qr[3,3] = parameters[203]
    Qr[4,4] = parameters[204]
    Qr[5,5] = parameters[205]
    Qr[6,6] = parameters[206]
    Qr[7,7] = parameters[207]
    Qr[8,8] = parameters[208]
    Qr[9,9] = parameters[209]
    Qr[10,10] = parameters[210]
    Qr[11,11] = parameters[211]
    Qr[12,12] = parameters[212]
    Qr[13,13] = parameters[213]
    Qr[14,14] = parameters[214]
    Qr[15,15] = parameters[215]
    Qr[16,16] = parameters[216]
    Qr[17,17] = parameters[217]
    Qr[18,18] = parameters[218]
    Qr[19,19] = parameters[219]
    Qr[20,0] = parameters[220]
    Qr[21,1] = parameters[221]
    Qr[22,2] = parameters[222]
    Qr[23,3] = parameters[223]
    Qr[24,4] = parameters[224]
    Qr[25,5] = parameters[225]
    Qr[26,6] = parameters[226]
    Qr[27,7] = parameters[227]
    Qr[28,8] = parameters[228]
    Qr[29,9] = parameters[229]
    Qr[30,10] = parameters[230]
    Qr[31,11] = parameters[231]
    Qr[32,12] = parameters[232]
    Qr[33,13] = parameters[233]
    Qr[34,14] = parameters[234]
    Qr[35,15] = parameters[235]
    Qr[36,16] = parameters[236]
    Qr[37,17] = parameters[237]
    Qr[38,18] = parameters[238]
    Qr[39,19] = parameters[239]
    Qr[40,0] = parameters[240]
    Qr[41,1] = parameters[241]
    Qr[42,2] = parameters[242]
    Qr[43,3] = parameters[243]
    Qr[44,4] = parameters[244]
    Qr[45,5] = parameters[245]
    Qr[46,6] = parameters[246]
    Qr[47,7] = parameters[247]
    Qr[48,8] = parameters[248]
    Qr[49,9] = parameters[249]
    Qr[50,10] = parameters[250]
    Qr[51,11] = parameters[251]
    Qr[52,12] = parameters[252]
    Qr[53,13] = parameters[253]
    Qr[54,14] = parameters[254]
    Qr[55,15] = parameters[255]
    Qr[56,16] = parameters[256]
    Qr[57,17] = parameters[257]
    Qr[58,18] = parameters[258]
    Qr[59,19] = parameters[259]
    Qr[60,0] = parameters[260]
    Qr[61,1] = parameters[261]
    Qr[62,2] = parameters[262]
    Qr[63,3] = parameters[263]
    Qr[64,4] = parameters[264]
    Qr[65,5] = parameters[265]
    Qr[66,6] = parameters[266]
    Qr[67,7] = parameters[267]
    Qr[68,8] = parameters[268]
    Qr[69,9] = parameters[269]
    Qr[70,10] = parameters[270]
    Qr[71,11] = parameters[271]
    Qr[72,12] = parameters[272]
    Qr[73,13] = parameters[273]
    Qr[74,14] = parameters[274]
    Qr[75,15] = parameters[275]
    Qr[76,16] = parameters[276]
    Qr[77,17] = parameters[277]
    Qr[78,18] = parameters[278]
    Qr[79,19] = parameters[279]
    Qr[80,0] = parameters[280]
    Qr[81,1] = parameters[281]
    Qr[82,2] = parameters[282]
    Qr[83,3] = parameters[283]
    Qr[84,4] = parameters[284]
    Qr[85,5] = parameters[285]
    Qr[86,6] = parameters[286]
    Qr[87,7] = parameters[287]
    Qr[88,8] = parameters[288]
    Qr[89,9] = parameters[289]
    Qr[90,10] = parameters[290]
    Qr[91,11] = parameters[291]
    Qr[92,12] = parameters[292]
    Qr[93,13] = parameters[293]
    Qr[94,14] = parameters[294]
    Qr[95,15] = parameters[295]
    Qr[96,16] = parameters[296]
    Qr[97,17] = parameters[297]
    Qr[98,18] = parameters[298]
    Qr[99,19] = parameters[299]
    Er[0,0] = parameters[300]
    Er[1,1] = parameters[301]
    Er[2,2] = parameters[302]
    Er[3,3] = parameters[303]
    Er[4,4] = parameters[304]
    Er[5,5] = parameters[305]
    Er[6,6] = parameters[306]
    Er[7,7] = parameters[307]
    Er[8,8] = parameters[308]
    Er[9,9] = parameters[309]
    Er[10,10] = parameters[310]
    Er[11,11] = parameters[311]
    Er[12,12] = parameters[312]
    Er[13,13] = parameters[313]
    Er[14,14] = parameters[314]
    Er[15,15] = parameters[315]
    Er[16,16] = parameters[316]
    Er[17,17] = parameters[317]
    Er[18,18] = parameters[318]
    Er[19,19] = parameters[319]
    Er[20,0] = parameters[320]
    Er[21,1] = parameters[321]
    Er[22,2] = parameters[322]
    Er[23,3] = parameters[323]
    Er[24,4] = parameters[324]
    Er[25,5] = parameters[325]
    Er[26,6] = parameters[326]
    Er[27,7] = parameters[327]
    Er[28,8] = parameters[328]
    Er[29,9] = parameters[329]
    Er[30,10] = parameters[330]
    Er[31,11] = parameters[331]
    Er[32,12] = parameters[332]
    Er[33,13] = parameters[333]
    Er[34,14] = parameters[334]
    Er[35,15] = parameters[335]
    Er[36,16] = parameters[336]
    Er[37,17] = parameters[337]
    Er[38,18] = parameters[338]
    Er[39,19] = parameters[339]
    Er[40,0] = parameters[340]
    Er[41,1] = parameters[341]
    Er[42,2] = parameters[342]
    Er[43,3] = parameters[343]
    Er[44,4] = parameters[344]
    Er[45,5] = parameters[345]
    Er[46,6] = parameters[346]
    Er[47,7] = parameters[347]
    Er[48,8] = parameters[348]
    Er[49,9] = parameters[349]
    Er[50,10] = parameters[350]
    Er[51,11] = parameters[351]
    Er[52,12] = parameters[352]
    Er[53,13] = parameters[353]
    Er[54,14] = parameters[354]
    Er[55,15] = parameters[355]
    Er[56,16] = parameters[356]
    Er[57,17] = parameters[357]
    Er[58,18] = parameters[358]
    Er[59,19] = parameters[359]
    Er[60,0] = parameters[360]
    Er[61,1] = parameters[361]
    Er[62,2] = parameters[362]
    Er[63,3] = parameters[363]
    Er[64,4] = parameters[364]
    Er[65,5] = parameters[365]
    Er[66,6] = parameters[366]
    Er[67,7] = parameters[367]
    Er[68,8] = parameters[368]
    Er[69,9] = parameters[369]
    Er[70,10] = parameters[370]
    Er[71,11] = parameters[371]
    Er[72,12] = parameters[372]
    Er[73,13] = parameters[373]
    Er[74,14] = parameters[374]
    Er[75,15] = parameters[375]
    Er[76,16] = parameters[376]
    Er[77,17] = parameters[377]
    Er[78,18] = parameters[378]
    Er[79,19] = parameters[379]
    Er[80,0] = parameters[380]
    Er[81,1] = parameters[381]
    Er[82,2] = parameters[382]
    Er[83,3] = parameters[383]
    Er[84,4] = parameters[384]
    Er[85,5] = parameters[385]
    Er[86,6] = parameters[386]
    Er[87,7] = parameters[387]
    Er[88,8] = parameters[388]
    Er[89,9] = parameters[389]
    Er[90,10] = parameters[390]
    Er[91,11] = parameters[391]
    Er[92,12] = parameters[392]
    Er[93,13] = parameters[393]
    Er[94,14] = parameters[394]
    Er[95,15] = parameters[395]
    Er[96,16] = parameters[396]
    Er[97,17] = parameters[397]
    Er[98,18] = parameters[398]
    Er[99,19] = parameters[399]
    Cr[0,0] = parameters[400]
    Cr[1,1] = parameters[401]
    Cr[2,2] = parameters[402]
    Cr[3,3] = parameters[403]
    Cr[4,4] = parameters[404]
    Cr[5,5] = parameters[405]
    Cr[6,6] = parameters[406]
    Cr[7,7] = parameters[407]
    Cr[8,8] = parameters[408]
    Cr[9,9] = parameters[409]
    Cr[10,10] = parameters[410]
    Cr[11,11] = parameters[411]
    Cr[12,12] = parameters[412]
    Cr[13,13] = parameters[413]
    Cr[14,14] = parameters[414]
    Cr[15,15] = parameters[415]
    Cr[16,16] = parameters[416]
    Cr[17,17] = parameters[417]
    Cr[18,18] = parameters[418]
    Cr[19,19] = parameters[419]
    Cr[20,0] = parameters[420]
    Cr[21,1] = parameters[421]
    Cr[22,2] = parameters[422]
    Cr[23,3] = parameters[423]
    Cr[24,4] = parameters[424]
    Cr[25,5] = parameters[425]
    Cr[26,6] = parameters[426]
    Cr[27,7] = parameters[427]
    Cr[28,8] = parameters[428]
    Cr[29,9] = parameters[429]
    Cr[30,10] = parameters[430]
    Cr[31,11] = parameters[431]
    Cr[32,12] = parameters[432]
    Cr[33,13] = parameters[433]
    Cr[34,14] = parameters[434]
    Cr[35,15] = parameters[435]
    Cr[36,16] = parameters[436]
    Cr[37,17] = parameters[437]
    Cr[38,18] = parameters[438]
    Cr[39,19] = parameters[439]
    Cr[40,0] = parameters[440]
    Cr[41,1] = parameters[441]
    Cr[42,2] = parameters[442]
    Cr[43,3] = parameters[443]
    Cr[44,4] = parameters[444]
    Cr[45,5] = parameters[445]
    Cr[46,6] = parameters[446]
    Cr[47,7] = parameters[447]
    Cr[48,8] = parameters[448]
    Cr[49,9] = parameters[449]
    Cr[50,10] = parameters[450]
    Cr[51,11] = parameters[451]
    Cr[52,12] = parameters[452]
    Cr[53,13] = parameters[453]
    Cr[54,14] = parameters[454]
    Cr[55,15] = parameters[455]
    Cr[56,16] = parameters[456]
    Cr[57,17] = parameters[457]
    Cr[58,18] = parameters[458]
    Cr[59,19] = parameters[459]
    Cr[60,0] = parameters[460]
    Cr[61,1] = parameters[461]
    Cr[62,2] = parameters[462]
    Cr[63,3] = parameters[463]
    Cr[64,4] = parameters[464]
    Cr[65,5] = parameters[465]
    Cr[66,6] = parameters[466]
    Cr[67,7] = parameters[467]
    Cr[68,8] = parameters[468]
    Cr[69,9] = parameters[469]
    Cr[70,10] = parameters[470]
    Cr[71,11] = parameters[471]
    Cr[72,12] = parameters[472]
    Cr[73,13] = parameters[473]
    Cr[74,14] = parameters[474]
    Cr[75,15] = parameters[475]
    Cr[76,16] = parameters[476]
    Cr[77,17] = parameters[477]
    Cr[78,18] = parameters[478]
    Cr[79,19] = parameters[479]
    Cr[80,0] = parameters[480]
    Cr[81,1] = parameters[481]
    Cr[82,2] = parameters[482]
    Cr[83,3] = parameters[483]
    Cr[84,4] = parameters[484]
    Cr[85,5] = parameters[485]
    Cr[86,6] = parameters[486]
    Cr[87,7] = parameters[487]
    Cr[88,8] = parameters[488]
    Cr[89,9] = parameters[489]
    Cr[90,10] = parameters[490]
    Cr[91,11] = parameters[491]
    Cr[92,12] = parameters[492]
    Cr[93,13] = parameters[493]
    Cr[94,14] = parameters[494]
    Cr[95,15] = parameters[495]
    Cr[96,16] = parameters[496]
    Cr[97,17] = parameters[497]
    Cr[98,18] = parameters[498]
    Cr[99,19] = parameters[499]
    Br[0,0] = parameters[500]
    Br[1,1] = parameters[501]
    Br[2,2] = parameters[502]
    Br[3,3] = parameters[503]
    Br[4,4] = parameters[504]
    Br[5,5] = parameters[505]
    Br[6,6] = parameters[506]
    Br[7,7] = parameters[507]
    Br[8,8] = parameters[508]
    Br[9,9] = parameters[509]
    Br[10,10] = parameters[510]
    Br[11,11] = parameters[511]
    Br[12,12] = parameters[512]
    Br[13,13] = parameters[513]
    Br[14,14] = parameters[514]
    Br[15,15] = parameters[515]
    Br[16,16] = parameters[516]
    Br[17,17] = parameters[517]
    Br[18,18] = parameters[518]
    Br[19,19] = parameters[519]
    Br[20,0] = parameters[520]
    Br[21,1] = parameters[521]
    Br[22,2] = parameters[522]
    Br[23,3] = parameters[523]
    Br[24,4] = parameters[524]
    Br[25,5] = parameters[525]
    Br[26,6] = parameters[526]
    Br[27,7] = parameters[527]
    Br[28,8] = parameters[528]
    Br[29,9] = parameters[529]
    Br[30,10] = parameters[530]
    Br[31,11] = parameters[531]
    Br[32,12] = parameters[532]
    Br[33,13] = parameters[533]
    Br[34,14] = parameters[534]
    Br[35,15] = parameters[535]
    Br[36,16] = parameters[536]
    Br[37,17] = parameters[537]
    Br[38,18] = parameters[538]
    Br[39,19] = parameters[539]
    Br[40,0] = parameters[540]
    Br[41,1] = parameters[541]
    Br[42,2] = parameters[542]
    Br[43,3] = parameters[543]
    Br[44,4] = parameters[544]
    Br[45,5] = parameters[545]
    Br[46,6] = parameters[546]
    Br[47,7] = parameters[547]
    Br[48,8] = parameters[548]
    Br[49,9] = parameters[549]
    Br[50,10] = parameters[550]
    Br[51,11] = parameters[551]
    Br[52,12] = parameters[552]
    Br[53,13] = parameters[553]
    Br[54,14] = parameters[554]
    Br[55,15] = parameters[555]
    Br[56,16] = parameters[556]
    Br[57,17] = parameters[557]
    Br[58,18] = parameters[558]
    Br[59,19] = parameters[559]
    Br[60,0] = parameters[560]
    Br[61,1] = parameters[561]
    Br[62,2] = parameters[562]
    Br[63,3] = parameters[563]
    Br[64,4] = parameters[564]
    Br[65,5] = parameters[565]
    Br[66,6] = parameters[566]
    Br[67,7] = parameters[567]
    Br[68,8] = parameters[568]
    Br[69,9] = parameters[569]
    Br[70,10] = parameters[570]
    Br[71,11] = parameters[571]
    Br[72,12] = parameters[572]
    Br[73,13] = parameters[573]
    Br[74,14] = parameters[574]
    Br[75,15] = parameters[575]
    Br[76,16] = parameters[576]
    Br[77,17] = parameters[577]
    Br[78,18] = parameters[578]
    Br[79,19] = parameters[579]
    Br[80,0] = parameters[580]
    Br[81,1] = parameters[581]
    Br[82,2] = parameters[582]
    Br[83,3] = parameters[583]
    Br[84,4] = parameters[584]
    Br[85,5] = parameters[585]
    Br[86,6] = parameters[586]
    Br[87,7] = parameters[587]
    Br[88,8] = parameters[588]
    Br[89,9] = parameters[589]
    Br[90,10] = parameters[590]
    Br[91,11] = parameters[591]
    Br[92,12] = parameters[592]
    Br[93,13] = parameters[593]
    Br[94,14] = parameters[594]
    Br[95,15] = parameters[595]
    Br[96,16] = parameters[596]
    Br[97,17] = parameters[597]
    Br[98,18] = parameters[598]
    Br[99,19] = parameters[599]
    Bhatr[0,0] = parameters[600]
    Bhatr[1,1] = parameters[601]
    Bhatr[2,2] = parameters[602]
    Bhatr[3,3] = parameters[603]
    Bhatr[4,4] = parameters[604]
    Bhatr[5,5] = parameters[605]
    Bhatr[6,6] = parameters[606]
    Bhatr[7,7] = parameters[607]
    Bhatr[8,8] = parameters[608]
    Bhatr[9,9] = parameters[609]
    Bhatr[10,10] = parameters[610]
    Bhatr[11,11] = parameters[611]
    Bhatr[12,12] = parameters[612]
    Bhatr[13,13] = parameters[613]
    Bhatr[14,14] = parameters[614]
    Bhatr[15,15] = parameters[615]
    Bhatr[16,16] = parameters[616]
    Bhatr[17,17] = parameters[617]
    Bhatr[18,18] = parameters[618]
    Bhatr[19,19] = parameters[619]
    Bhatr[20,0] = parameters[620]
    Bhatr[21,1] = parameters[621]
    Bhatr[22,2] = parameters[622]
    Bhatr[23,3] = parameters[623]
    Bhatr[24,4] = parameters[624]
    Bhatr[25,5] = parameters[625]
    Bhatr[26,6] = parameters[626]
    Bhatr[27,7] = parameters[627]
    Bhatr[28,8] = parameters[628]
    Bhatr[29,9] = parameters[629]
    Bhatr[30,10] = parameters[630]
    Bhatr[31,11] = parameters[631]
    Bhatr[32,12] = parameters[632]
    Bhatr[33,13] = parameters[633]
    Bhatr[34,14] = parameters[634]
    Bhatr[35,15] = parameters[635]
    Bhatr[36,16] = parameters[636]
    Bhatr[37,17] = parameters[637]
    Bhatr[38,18] = parameters[638]
    Bhatr[39,19] = parameters[639]
    Bhatr[40,0] = parameters[640]
    Bhatr[41,1] = parameters[641]
    Bhatr[42,2] = parameters[642]
    Bhatr[43,3] = parameters[643]
    Bhatr[44,4] = parameters[644]
    Bhatr[45,5] = parameters[645]
    Bhatr[46,6] = parameters[646]
    Bhatr[47,7] = parameters[647]
    Bhatr[48,8] = parameters[648]
    Bhatr[49,9] = parameters[649]
    Bhatr[50,10] = parameters[650]
    Bhatr[51,11] = parameters[651]
    Bhatr[52,12] = parameters[652]
    Bhatr[53,13] = parameters[653]
    Bhatr[54,14] = parameters[654]
    Bhatr[55,15] = parameters[655]
    Bhatr[56,16] = parameters[656]
    Bhatr[57,17] = parameters[657]
    Bhatr[58,18] = parameters[658]
    Bhatr[59,19] = parameters[659]
    Bhatr[60,0] = parameters[660]
    Bhatr[61,1] = parameters[661]
    Bhatr[62,2] = parameters[662]
    Bhatr[63,3] = parameters[663]
    Bhatr[64,4] = parameters[664]
    Bhatr[65,5] = parameters[665]
    Bhatr[66,6] = parameters[666]
    Bhatr[67,7] = parameters[667]
    Bhatr[68,8] = parameters[668]
    Bhatr[69,9] = parameters[669]
    Bhatr[70,10] = parameters[670]
    Bhatr[71,11] = parameters[671]
    Bhatr[72,12] = parameters[672]
    Bhatr[73,13] = parameters[673]
    Bhatr[74,14] = parameters[674]
    Bhatr[75,15] = parameters[675]
    Bhatr[76,16] = parameters[676]
    Bhatr[77,17] = parameters[677]
    Bhatr[78,18] = parameters[678]
    Bhatr[79,19] = parameters[679]
    Bhatr[80,0] = parameters[680]
    Bhatr[81,1] = parameters[681]
    Bhatr[82,2] = parameters[682]
    Bhatr[83,3] = parameters[683]
    Bhatr[84,4] = parameters[684]
    Bhatr[85,5] = parameters[685]
    Bhatr[86,6] = parameters[686]
    Bhatr[87,7] = parameters[687]
    Bhatr[88,8] = parameters[688]
    Bhatr[89,9] = parameters[689]
    Bhatr[90,10] = parameters[690]
    Bhatr[91,11] = parameters[691]
    Bhatr[92,12] = parameters[692]
    Bhatr[93,13] = parameters[693]
    Bhatr[94,14] = parameters[694]
    Bhatr[95,15] = parameters[695]
    Bhatr[96,16] = parameters[696]
    Bhatr[97,17] = parameters[697]
    Bhatr[98,18] = parameters[698]
    Bhatr[99,19] = parameters[699]

        
def initialise_variables(states, variables):
  
    #State values
    states[0] = 1e-12
    states[1] = 0.00100000000000000
    states[2] = 1e-12
    states[3] = 0.0360400000000000
    states[4] = 1e-12
    states[5] = 0.00100000000000000
    states[6] = 1e-12
    states[7] = 0.0360400000000000
    states[8] = 1e-12
    states[9] = 0.00100000000000000
    states[10] = 1e-12
    states[11] = 0.0360400000000000
    states[12] = 1e-12
    states[13] = 0.00100000000000000
    states[14] = 1e-12
    states[15] = 0.0360400000000000
    states[16] = 1e-12
    states[17] = 0.00100000000000000
    states[18] = 1e-12
    states[19] = 0.0360400000000000
    states[20] = 1e-12
    states[21] = 0.00100000000000000
    states[22] = 1e-12
    states[23] = 0.0360400000000000
    states[24] = 1e-12
    states[25] = 0.00100000000000000
    states[26] = 1e-12
    states[27] = 0.0360400000000000
    states[28] = 1e-12
    states[29] = 0.00100000000000000
    states[30] = 1e-12
    states[31] = 0.0360400000000000
    states[32] = 1e-12
    states[33] = 0.00100000000000000
    states[34] = 1e-12
    states[35] = 0.0360400000000000
    states[36] = 1e-12
    states[37] = 0.00100000000000000
    states[38] = 1e-12
    states[39] = 0.0360400000000000
    states[40] = 1e-12
    states[41] = 0.00100000000000000
    states[42] = 1e-12
    states[43] = 0.0360400000000000
    states[44] = 1e-12
    states[45] = 0.00100000000000000
    states[46] = 1e-12
    states[47] = 0.0360400000000000
    states[48] = 1e-12
    states[49] = 0.00100000000000000
    states[50] = 1e-12
    states[51] = 0.0360400000000000
    states[52] = 1e-12
    states[53] = 0.00100000000000000
    states[54] = 1e-12
    states[55] = 0.0360400000000000
    states[56] = 1e-12
    states[57] = 0.00100000000000000
    states[58] = 1e-12
    states[59] = 0.0360400000000000
    states[60] = 1e-12
    states[61] = 0.00100000000000000
    states[62] = 1e-12
    states[63] = 0.0360400000000000
    states[64] = 1e-12
    states[65] = 0.00100000000000000
    states[66] = 1e-12
    states[67] = 0.0360400000000000
    states[68] = 1e-12
    states[69] = 0.00100000000000000
    states[70] = 1e-12
    states[71] = 0.0360400000000000
    states[72] = 1e-12
    states[73] = 0.00100000000000000
    states[74] = 1e-12
    states[75] = 0.0360400000000000
    states[76] = 1e-12
    states[77] = 0.00100000000000000
    states[78] = 1e-12
    states[79] = 0.0360400000000000
    states[80] = 1e-12
    states[81] = 0.00100000000000000
    states[82] = 1e-12
    states[83] = 0.0360400000000000
    states[84] = 1e-12
    states[85] = 0.00100000000000000
    states[86] = 1e-12
    states[87] = 0.0360400000000000
    states[88] = 1e-12
    states[89] = 0.00100000000000000
    states[90] = 1e-12
    states[91] = 0.0360400000000000
    states[92] = 1e-12
    states[93] = 0.00100000000000000
    states[94] = 1e-12
    states[95] = 0.0360400000000000
    states[96] = 1e-12
    states[97] = 0.00100000000000000
    states[98] = 1e-12
    states[99] = 0.0360400000000000
    variables[1] = states[0]*(-0.016502*Heaviside(0.2925 - states[0])*Heaviside(states[2] - 0.78) + 0.016602)
    variables[2] = -0.016502*Heaviside(0.2925 - states[0])*Heaviside(states[2] - 0.78) + 0.016602
    variables[3] = 9.28461798035093*exp(-270.806766140199*(states[2] - 1)**2)
    variables[4] = states[2]*(-states[3] - 8.0*(states[2] - 1)*(states[2] - 0.13))
    variables[5] = -(8.0*states[2]*(states[2] - 1.13) + states[3])*(0.002*states[2] + 0.2*states[3] + 0.0006)/(states[2] + 0.3)
    variables[6] = states[4]*(-0.016502*Heaviside(0.2925 - states[4])*Heaviside(states[6] - 0.78) + 0.016602)
    variables[7] = -0.016502*Heaviside(0.2925 - states[4])*Heaviside(states[6] - 0.78) + 0.016602
    variables[8] = 9.28461798035093*exp(-270.806766140199*(states[6] - 1)**2)
    variables[9] = states[6]*(-states[7] - 8.0*(states[6] - 1)*(states[6] - 0.13))
    variables[10] = -(8.0*states[6]*(states[6] - 1.13) + states[7])*(0.002*states[6] + 0.2*states[7] + 0.0006)/(states[6] + 0.3)
    variables[11] = states[8]*(-0.016502*Heaviside(0.2925 - states[8])*Heaviside(states[10] - 0.78) + 0.016602)
    variables[12] = -0.016502*Heaviside(0.2925 - states[8])*Heaviside(states[10] - 0.78) + 0.016602
    variables[13] = 9.28461798035093*exp(-270.806766140199*(states[10] - 1)**2)
    variables[14] = states[10]*(-states[11] - 8.0*(states[10] - 1)*(states[10] - 0.13))
    variables[15] = -(8.0*states[10]*(states[10] - 1.13) + states[11])*(0.002*states[10] + 0.2*states[11] + 0.0006)/(states[10] + 0.3)
    variables[16] = states[12]*(-0.016502*Heaviside(0.2925 - states[12])*Heaviside(states[14] - 0.78) + 0.016602)
    variables[17] = -0.016502*Heaviside(0.2925 - states[12])*Heaviside(states[14] - 0.78) + 0.016602
    variables[18] = 9.28461798035093*exp(-270.806766140199*(states[14] - 1)**2)
    variables[19] = states[14]*(-states[15] - 8.0*(states[14] - 1)*(states[14] - 0.13))
    variables[20] = -(8.0*states[14]*(states[14] - 1.13) + states[15])*(0.002*states[14] + 0.2*states[15] + 0.0006)/(states[14] + 0.3)
    variables[21] = states[16]*(-0.016502*Heaviside(0.2925 - states[16])*Heaviside(states[18] - 0.78) + 0.016602)
    variables[22] = -0.016502*Heaviside(0.2925 - states[16])*Heaviside(states[18] - 0.78) + 0.016602
    variables[23] = 9.28461798035093*exp(-270.806766140199*(states[18] - 1)**2)
    variables[24] = states[18]*(-states[19] - 8.0*(states[18] - 1)*(states[18] - 0.13))
    variables[25] = -(8.0*states[18]*(states[18] - 1.13) + states[19])*(0.002*states[18] + 0.2*states[19] + 0.0006)/(states[18] + 0.3)
    variables[26] = states[20]*(-0.016502*Heaviside(0.2925 - states[20])*Heaviside(states[22] - 0.78) + 0.016602)
    variables[27] = -0.016502*Heaviside(0.2925 - states[20])*Heaviside(states[22] - 0.78) + 0.016602
    variables[28] = 9.28461798035093*exp(-270.806766140199*(states[22] - 1)**2)
    variables[29] = states[22]*(-states[23] - 8.0*(states[22] - 1)*(states[22] - 0.13))
    variables[30] = -(8.0*states[22]*(states[22] - 1.13) + states[23])*(0.002*states[22] + 0.2*states[23] + 0.0006)/(states[22] + 0.3)
    variables[31] = states[24]*(-0.016502*Heaviside(0.2925 - states[24])*Heaviside(states[26] - 0.78) + 0.016602)
    variables[32] = -0.016502*Heaviside(0.2925 - states[24])*Heaviside(states[26] - 0.78) + 0.016602
    variables[33] = 9.28461798035093*exp(-270.806766140199*(states[26] - 1)**2)
    variables[34] = states[26]*(-states[27] - 8.0*(states[26] - 1)*(states[26] - 0.13))
    variables[35] = -(8.0*states[26]*(states[26] - 1.13) + states[27])*(0.002*states[26] + 0.2*states[27] + 0.0006)/(states[26] + 0.3)
    variables[36] = states[28]*(-0.016502*Heaviside(0.2925 - states[28])*Heaviside(states[30] - 0.78) + 0.016602)
    variables[37] = -0.016502*Heaviside(0.2925 - states[28])*Heaviside(states[30] - 0.78) + 0.016602
    variables[38] = 9.28461798035093*exp(-270.806766140199*(states[30] - 1)**2)
    variables[39] = states[30]*(-states[31] - 8.0*(states[30] - 1)*(states[30] - 0.13))
    variables[40] = -(8.0*states[30]*(states[30] - 1.13) + states[31])*(0.002*states[30] + 0.2*states[31] + 0.0006)/(states[30] + 0.3)
    variables[41] = states[32]*(-0.016502*Heaviside(0.2925 - states[32])*Heaviside(states[34] - 0.78) + 0.016602)
    variables[42] = -0.016502*Heaviside(0.2925 - states[32])*Heaviside(states[34] - 0.78) + 0.016602
    variables[43] = 9.28461798035093*exp(-270.806766140199*(states[34] - 1)**2)
    variables[44] = states[34]*(-states[35] - 8.0*(states[34] - 1)*(states[34] - 0.13))
    variables[45] = -(8.0*states[34]*(states[34] - 1.13) + states[35])*(0.002*states[34] + 0.2*states[35] + 0.0006)/(states[34] + 0.3)
    variables[46] = states[36]*(-0.016502*Heaviside(0.2925 - states[36])*Heaviside(states[38] - 0.78) + 0.016602)
    variables[47] = -0.016502*Heaviside(0.2925 - states[36])*Heaviside(states[38] - 0.78) + 0.016602
    variables[48] = 9.28461798035093*exp(-270.806766140199*(states[38] - 1)**2)
    variables[49] = states[38]*(-states[39] - 8.0*(states[38] - 1)*(states[38] - 0.13))
    variables[50] = -(8.0*states[38]*(states[38] - 1.13) + states[39])*(0.002*states[38] + 0.2*states[39] + 0.0006)/(states[38] + 0.3)
    variables[51] = states[40]*(-0.016502*Heaviside(0.2925 - states[40])*Heaviside(states[42] - 0.78) + 0.016602)
    variables[52] = -0.016502*Heaviside(0.2925 - states[40])*Heaviside(states[42] - 0.78) + 0.016602
    variables[53] = 9.28461798035093*exp(-270.806766140199*(states[42] - 1)**2)
    variables[54] = states[42]*(-states[43] - 8.0*(states[42] - 1)*(states[42] - 0.13))
    variables[55] = -(8.0*states[42]*(states[42] - 1.13) + states[43])*(0.002*states[42] + 0.2*states[43] + 0.0006)/(states[42] + 0.3)
    variables[56] = states[44]*(-0.016502*Heaviside(0.2925 - states[44])*Heaviside(states[46] - 0.78) + 0.016602)
    variables[57] = -0.016502*Heaviside(0.2925 - states[44])*Heaviside(states[46] - 0.78) + 0.016602
    variables[58] = 9.28461798035093*exp(-270.806766140199*(states[46] - 1)**2)
    variables[59] = states[46]*(-states[47] - 8.0*(states[46] - 1)*(states[46] - 0.13))
    variables[60] = -(8.0*states[46]*(states[46] - 1.13) + states[47])*(0.002*states[46] + 0.2*states[47] + 0.0006)/(states[46] + 0.3)
    variables[61] = states[48]*(-0.016502*Heaviside(0.2925 - states[48])*Heaviside(states[50] - 0.78) + 0.016602)
    variables[62] = -0.016502*Heaviside(0.2925 - states[48])*Heaviside(states[50] - 0.78) + 0.016602
    variables[63] = 9.28461798035093*exp(-270.806766140199*(states[50] - 1)**2)
    variables[64] = states[50]*(-states[51] - 8.0*(states[50] - 1)*(states[50] - 0.13))
    variables[65] = -(8.0*states[50]*(states[50] - 1.13) + states[51])*(0.002*states[50] + 0.2*states[51] + 0.0006)/(states[50] + 0.3)
    variables[66] = states[52]*(-0.016502*Heaviside(0.2925 - states[52])*Heaviside(states[54] - 0.78) + 0.016602)
    variables[67] = -0.016502*Heaviside(0.2925 - states[52])*Heaviside(states[54] - 0.78) + 0.016602
    variables[68] = 9.28461798035093*exp(-270.806766140199*(states[54] - 1)**2)
    variables[69] = states[54]*(-states[55] - 8.0*(states[54] - 1)*(states[54] - 0.13))
    variables[70] = -(8.0*states[54]*(states[54] - 1.13) + states[55])*(0.002*states[54] + 0.2*states[55] + 0.0006)/(states[54] + 0.3)
    variables[71] = states[56]*(-0.016502*Heaviside(0.2925 - states[56])*Heaviside(states[58] - 0.78) + 0.016602)
    variables[72] = -0.016502*Heaviside(0.2925 - states[56])*Heaviside(states[58] - 0.78) + 0.016602
    variables[73] = 9.28461798035093*exp(-270.806766140199*(states[58] - 1)**2)
    variables[74] = states[58]*(-states[59] - 8.0*(states[58] - 1)*(states[58] - 0.13))
    variables[75] = -(8.0*states[58]*(states[58] - 1.13) + states[59])*(0.002*states[58] + 0.2*states[59] + 0.0006)/(states[58] + 0.3)
    variables[76] = states[60]*(-0.016502*Heaviside(0.2925 - states[60])*Heaviside(states[62] - 0.78) + 0.016602)
    variables[77] = -0.016502*Heaviside(0.2925 - states[60])*Heaviside(states[62] - 0.78) + 0.016602
    variables[78] = 9.28461798035093*exp(-270.806766140199*(states[62] - 1)**2)
    variables[79] = states[62]*(-states[63] - 8.0*(states[62] - 1)*(states[62] - 0.13))
    variables[80] = -(8.0*states[62]*(states[62] - 1.13) + states[63])*(0.002*states[62] + 0.2*states[63] + 0.0006)/(states[62] + 0.3)
    variables[81] = states[64]*(-0.016502*Heaviside(0.2925 - states[64])*Heaviside(states[66] - 0.78) + 0.016602)
    variables[82] = -0.016502*Heaviside(0.2925 - states[64])*Heaviside(states[66] - 0.78) + 0.016602
    variables[83] = 9.28461798035093*exp(-270.806766140199*(states[66] - 1)**2)
    variables[84] = states[66]*(-states[67] - 8.0*(states[66] - 1)*(states[66] - 0.13))
    variables[85] = -(8.0*states[66]*(states[66] - 1.13) + states[67])*(0.002*states[66] + 0.2*states[67] + 0.0006)/(states[66] + 0.3)
    variables[86] = states[68]*(-0.016502*Heaviside(0.2925 - states[68])*Heaviside(states[70] - 0.78) + 0.016602)
    variables[87] = -0.016502*Heaviside(0.2925 - states[68])*Heaviside(states[70] - 0.78) + 0.016602
    variables[88] = 9.28461798035093*exp(-270.806766140199*(states[70] - 1)**2)
    variables[89] = states[70]*(-states[71] - 8.0*(states[70] - 1)*(states[70] - 0.13))
    variables[90] = -(8.0*states[70]*(states[70] - 1.13) + states[71])*(0.002*states[70] + 0.2*states[71] + 0.0006)/(states[70] + 0.3)
    variables[91] = states[72]*(-0.016502*Heaviside(0.2925 - states[72])*Heaviside(states[74] - 0.78) + 0.016602)
    variables[92] = -0.016502*Heaviside(0.2925 - states[72])*Heaviside(states[74] - 0.78) + 0.016602
    variables[93] = 9.28461798035093*exp(-270.806766140199*(states[74] - 1)**2)
    variables[94] = states[74]*(-states[75] - 8.0*(states[74] - 1)*(states[74] - 0.13))
    variables[95] = -(8.0*states[74]*(states[74] - 1.13) + states[75])*(0.002*states[74] + 0.2*states[75] + 0.0006)/(states[74] + 0.3)
    variables[96] = states[76]*(-0.016502*Heaviside(0.2925 - states[76])*Heaviside(states[78] - 0.78) + 0.016602)
    variables[97] = -0.016502*Heaviside(0.2925 - states[76])*Heaviside(states[78] - 0.78) + 0.016602
    variables[98] = 9.28461798035093*exp(-270.806766140199*(states[78] - 1)**2)
    variables[99] = states[78]*(-states[79] - 8.0*(states[78] - 1)*(states[78] - 0.13))
    variables[100] = -(8.0*states[78]*(states[78] - 1.13) + states[79])*(0.002*states[78] + 0.2*states[79] + 0.0006)/(states[78] + 0.3)
    variables[101] = states[80]*(-0.016502*Heaviside(0.2925 - states[80])*Heaviside(states[82] - 0.78) + 0.016602)
    variables[102] = -0.016502*Heaviside(0.2925 - states[80])*Heaviside(states[82] - 0.78) + 0.016602
    variables[103] = 9.28461798035093*exp(-270.806766140199*(states[82] - 1)**2)
    variables[104] = states[82]*(-states[83] - 8.0*(states[82] - 1)*(states[82] - 0.13))
    variables[105] = -(8.0*states[82]*(states[82] - 1.13) + states[83])*(0.002*states[82] + 0.2*states[83] + 0.0006)/(states[82] + 0.3)
    variables[106] = states[84]*(-0.016502*Heaviside(0.2925 - states[84])*Heaviside(states[86] - 0.78) + 0.016602)
    variables[107] = -0.016502*Heaviside(0.2925 - states[84])*Heaviside(states[86] - 0.78) + 0.016602
    variables[108] = 9.28461798035093*exp(-270.806766140199*(states[86] - 1)**2)
    variables[109] = states[86]*(-states[87] - 8.0*(states[86] - 1)*(states[86] - 0.13))
    variables[110] = -(8.0*states[86]*(states[86] - 1.13) + states[87])*(0.002*states[86] + 0.2*states[87] + 0.0006)/(states[86] + 0.3)
    variables[111] = states[88]*(-0.016502*Heaviside(0.2925 - states[88])*Heaviside(states[90] - 0.78) + 0.016602)
    variables[112] = -0.016502*Heaviside(0.2925 - states[88])*Heaviside(states[90] - 0.78) + 0.016602
    variables[113] = 9.28461798035093*exp(-270.806766140199*(states[90] - 1)**2)
    variables[114] = states[90]*(-states[91] - 8.0*(states[90] - 1)*(states[90] - 0.13))
    variables[115] = -(8.0*states[90]*(states[90] - 1.13) + states[91])*(0.002*states[90] + 0.2*states[91] + 0.0006)/(states[90] + 0.3)
    variables[116] = states[92]*(-0.016502*Heaviside(0.2925 - states[92])*Heaviside(states[94] - 0.78) + 0.016602)
    variables[117] = -0.016502*Heaviside(0.2925 - states[92])*Heaviside(states[94] - 0.78) + 0.016602
    variables[118] = 9.28461798035093*exp(-270.806766140199*(states[94] - 1)**2)
    variables[119] = states[94]*(-states[95] - 8.0*(states[94] - 1)*(states[94] - 0.13))
    variables[120] = -(8.0*states[94]*(states[94] - 1.13) + states[95])*(0.002*states[94] + 0.2*states[95] + 0.0006)/(states[94] + 0.3)
    variables[121] = states[96]*(-0.016502*Heaviside(0.2925 - states[96])*Heaviside(states[98] - 0.78) + 0.016602)
    variables[122] = -0.016502*Heaviside(0.2925 - states[96])*Heaviside(states[98] - 0.78) + 0.016602
    variables[123] = 9.28461798035093*exp(-270.806766140199*(states[98] - 1)**2)
    variables[124] = states[98]*(-states[99] - 8.0*(states[98] - 1)*(states[98] - 0.13))
    variables[125] = -(8.0*states[98]*(states[98] - 1.13) + states[99])*(0.002*states[98] + 0.2*states[99] + 0.0006)/(states[98] + 0.3)

    #Ict matrix entries
    Ict[0,0] = 1
    Ict[1,1] = 1
    Ict[2,2] = 1
    Ict[3,3] = 1
    Ict[4,4] = 1
    Ict[5,5] = 1
    Ict[6,6] = 1
    Ict[7,7] = 1
    Ict[8,8] = 1
    Ict[9,9] = 1
    Ict[10,10] = 1
    Ict[11,11] = 1
    Ict[12,12] = 1
    Ict[13,13] = 1
    Ict[14,14] = 1
    Ict[15,15] = 1
    Ict[16,16] = 1
    Ict[17,17] = 1
    Ict[18,18] = 1
    Ict[19,19] = 1
    Ict[20,0] = 1
    Ict[21,1] = 1
    Ict[22,2] = 1
    Ict[23,3] = 1
    Ict[24,4] = 1
    Ict[25,5] = 1
    Ict[26,6] = 1
    Ict[27,7] = 1
    Ict[28,8] = 1
    Ict[29,9] = 1
    Ict[30,10] = 1
    Ict[31,11] = 1
    Ict[32,12] = 1
    Ict[33,13] = 1
    Ict[34,14] = 1
    Ict[35,15] = 1
    Ict[36,16] = 1
    Ict[37,17] = 1
    Ict[38,18] = 1
    Ict[39,19] = 1
    Ict[40,0] = 1
    Ict[41,1] = 1
    Ict[42,2] = 1
    Ict[43,3] = 1
    Ict[44,4] = 1
    Ict[45,5] = 1
    Ict[46,6] = 1
    Ict[47,7] = 1
    Ict[48,8] = 1
    Ict[49,9] = 1
    Ict[50,10] = 1
    Ict[51,11] = 1
    Ict[52,12] = 1
    Ict[53,13] = 1
    Ict[54,14] = 1
    Ict[55,15] = 1
    Ict[56,16] = 1
    Ict[57,17] = 1
    Ict[58,18] = 1
    Ict[59,19] = 1
    Ict[60,0] = 1
    Ict[61,1] = 1
    Ict[62,2] = 1
    Ict[63,3] = 1
    Ict[64,4] = 1
    Ict[65,5] = 1
    Ict[66,6] = 1
    Ict[67,7] = 1
    Ict[68,8] = 1
    Ict[69,9] = 1
    Ict[70,10] = 1
    Ict[71,11] = 1
    Ict[72,12] = 1
    Ict[73,13] = 1
    Ict[74,14] = 1
    Ict[75,15] = 1
    Ict[76,16] = 1
    Ict[77,17] = 1
    Ict[78,18] = 1
    Ict[79,19] = 1
    Ict[80,0] = 1
    Ict[81,1] = 1
    Ict[82,2] = 1
    Ict[83,3] = 1
    Ict[84,4] = 1
    Ict[85,5] = 1
    Ict[86,6] = 1
    Ict[87,7] = 1
    Ict[88,8] = 1
    Ict[89,9] = 1
    Ict[90,10] = 1
    Ict[91,11] = 1
    Ict[92,12] = 1
    Ict[93,13] = 1
    Ict[94,14] = 1
    Ict[95,15] = 1
    Ict[96,16] = 1
    Ict[97,17] = 1
    Ict[98,18] = 1
    Ict[99,19] = 1

    #Reduced to Full matrix entries
    R2F[0,0] = 1
    R2F[1,1] = 1
    R2F[2,2] = 1
    R2F[3,3] = 1
    R2F[4,4] = 1
    R2F[5,5] = 1
    R2F[6,6] = 1
    R2F[7,7] = 1
    R2F[8,8] = 1
    R2F[9,9] = 1
    R2F[10,10] = 1
    R2F[11,11] = 1
    R2F[12,12] = 1
    R2F[13,13] = 1
    R2F[14,14] = 1
    R2F[15,15] = 1
    R2F[16,16] = 1
    R2F[17,17] = 1
    R2F[18,18] = 1
    R2F[19,19] = 1
    R2F[20,0] = 1
    R2F[21,1] = 1
    R2F[22,2] = 1
    R2F[23,3] = 1
    R2F[24,4] = 1
    R2F[25,5] = 1
    R2F[26,6] = 1
    R2F[27,7] = 1
    R2F[28,8] = 1
    R2F[29,9] = 1
    R2F[30,10] = 1
    R2F[31,11] = 1
    R2F[32,12] = 1
    R2F[33,13] = 1
    R2F[34,14] = 1
    R2F[35,15] = 1
    R2F[36,16] = 1
    R2F[37,17] = 1
    R2F[38,18] = 1
    R2F[39,19] = 1
    R2F[40,0] = 1
    R2F[41,1] = 1
    R2F[42,2] = 1
    R2F[43,3] = 1
    R2F[44,4] = 1
    R2F[45,5] = 1
    R2F[46,6] = 1
    R2F[47,7] = 1
    R2F[48,8] = 1
    R2F[49,9] = 1
    R2F[50,10] = 1
    R2F[51,11] = 1
    R2F[52,12] = 1
    R2F[53,13] = 1
    R2F[54,14] = 1
    R2F[55,15] = 1
    R2F[56,16] = 1
    R2F[57,17] = 1
    R2F[58,18] = 1
    R2F[59,19] = 1
    R2F[60,0] = 1
    R2F[61,1] = 1
    R2F[62,2] = 1
    R2F[63,3] = 1
    R2F[64,4] = 1
    R2F[65,5] = 1
    R2F[66,6] = 1
    R2F[67,7] = 1
    R2F[68,8] = 1
    R2F[69,9] = 1
    R2F[70,10] = 1
    R2F[71,11] = 1
    R2F[72,12] = 1
    R2F[73,13] = 1
    R2F[74,14] = 1
    R2F[75,15] = 1
    R2F[76,16] = 1
    R2F[77,17] = 1
    R2F[78,18] = 1
    R2F[79,19] = 1
    R2F[80,0] = 1
    R2F[81,1] = 1
    R2F[82,2] = 1
    R2F[83,3] = 1
    R2F[84,4] = 1
    R2F[85,5] = 1
    R2F[86,6] = 1
    R2F[87,7] = 1
    R2F[88,8] = 1
    R2F[89,9] = 1
    R2F[90,10] = 1
    R2F[91,11] = 1
    R2F[92,12] = 1
    R2F[93,13] = 1
    R2F[94,14] = 1
    R2F[95,15] = 1
    R2F[96,16] = 1
    R2F[97,17] = 1
    R2F[98,18] = 1
    R2F[99,19] = 1

    #PHS matrix - constant entries
    R[0,0]=0.0166020000000000
    R[4,4]=0.0166020000000000
    R[8,8]=0.0166020000000000
    R[12,12]=0.0166020000000000
    R[16,16]=0.0166020000000000
    R[20,20]=0.0166020000000000
    R[24,24]=0.0166020000000000
    R[28,28]=0.0166020000000000
    R[32,32]=0.0166020000000000
    R[36,36]=0.0166020000000000
    R[40,40]=0.0166020000000000
    R[44,44]=0.0166020000000000
    R[48,48]=0.0166020000000000
    R[52,52]=0.0166020000000000
    R[56,56]=0.0166020000000000
    R[60,60]=0.0166020000000000
    R[64,64]=0.0166020000000000
    R[68,68]=0.0166020000000000
    R[72,72]=0.0166020000000000
    R[76,76]=0.0166020000000000
    R[80,80]=0.0166020000000000
    R[84,84]=0.0166020000000000
    R[88,88]=0.0166020000000000
    R[92,92]=0.0166020000000000
    R[96,96]=0.0166020000000000
    Q[0,0]=1
    Q[1,1]=1
    Q[2,2]=1
    Q[3,3]=1
    Q[4,4]=1
    Q[5,5]=1
    Q[6,6]=1
    Q[7,7]=1
    Q[8,8]=1
    Q[9,9]=1
    Q[10,10]=1
    Q[11,11]=1
    Q[12,12]=1
    Q[13,13]=1
    Q[14,14]=1
    Q[15,15]=1
    Q[16,16]=1
    Q[17,17]=1
    Q[18,18]=1
    Q[19,19]=1
    Q[20,20]=1
    Q[21,21]=1
    Q[22,22]=1
    Q[23,23]=1
    Q[24,24]=1
    Q[25,25]=1
    Q[26,26]=1
    Q[27,27]=1
    Q[28,28]=1
    Q[29,29]=1
    Q[30,30]=1
    Q[31,31]=1
    Q[32,32]=1
    Q[33,33]=1
    Q[34,34]=1
    Q[35,35]=1
    Q[36,36]=1
    Q[37,37]=1
    Q[38,38]=1
    Q[39,39]=1
    Q[40,40]=1
    Q[41,41]=1
    Q[42,42]=1
    Q[43,43]=1
    Q[44,44]=1
    Q[45,45]=1
    Q[46,46]=1
    Q[47,47]=1
    Q[48,48]=1
    Q[49,49]=1
    Q[50,50]=1
    Q[51,51]=1
    Q[52,52]=1
    Q[53,53]=1
    Q[54,54]=1
    Q[55,55]=1
    Q[56,56]=1
    Q[57,57]=1
    Q[58,58]=1
    Q[59,59]=1
    Q[60,60]=1
    Q[61,61]=1
    Q[62,62]=1
    Q[63,63]=1
    Q[64,64]=1
    Q[65,65]=1
    Q[66,66]=1
    Q[67,67]=1
    Q[68,68]=1
    Q[69,69]=1
    Q[70,70]=1
    Q[71,71]=1
    Q[72,72]=1
    Q[73,73]=1
    Q[74,74]=1
    Q[75,75]=1
    Q[76,76]=1
    Q[77,77]=1
    Q[78,78]=1
    Q[79,79]=1
    Q[80,80]=1
    Q[81,81]=1
    Q[82,82]=1
    Q[83,83]=1
    Q[84,84]=1
    Q[85,85]=1
    Q[86,86]=1
    Q[87,87]=1
    Q[88,88]=1
    Q[89,89]=1
    Q[90,90]=1
    Q[91,91]=1
    Q[92,92]=1
    Q[93,93]=1
    Q[94,94]=1
    Q[95,95]=1
    Q[96,96]=1
    Q[97,97]=1
    Q[98,98]=1
    Q[99,99]=1
    Einv[0,0]=1
    Einv[1,1]=1
    Einv[2,2]=0.0775000000000000
    Einv[3,3]=0.0775000000000000
    Einv[4,4]=1
    Einv[5,5]=1
    Einv[6,6]=0.0775000000000000
    Einv[7,7]=0.0775000000000000
    Einv[8,8]=1
    Einv[9,9]=1
    Einv[10,10]=0.0775000000000000
    Einv[11,11]=0.0775000000000000
    Einv[12,12]=1
    Einv[13,13]=1
    Einv[14,14]=0.0775000000000000
    Einv[15,15]=0.0775000000000000
    Einv[16,16]=1
    Einv[17,17]=1
    Einv[18,18]=0.0775000000000000
    Einv[19,19]=0.0775000000000000
    Einv[20,20]=1
    Einv[21,21]=1
    Einv[22,22]=0.0775000000000000
    Einv[23,23]=0.0775000000000000
    Einv[24,24]=1
    Einv[25,25]=1
    Einv[26,26]=0.0775000000000000
    Einv[27,27]=0.0775000000000000
    Einv[28,28]=1
    Einv[29,29]=1
    Einv[30,30]=0.0775000000000000
    Einv[31,31]=0.0775000000000000
    Einv[32,32]=1
    Einv[33,33]=1
    Einv[34,34]=0.0775000000000000
    Einv[35,35]=0.0775000000000000
    Einv[36,36]=1
    Einv[37,37]=1
    Einv[38,38]=0.0775000000000000
    Einv[39,39]=0.0775000000000000
    Einv[40,40]=1
    Einv[41,41]=1
    Einv[42,42]=0.0775000000000000
    Einv[43,43]=0.0775000000000000
    Einv[44,44]=1
    Einv[45,45]=1
    Einv[46,46]=0.0775000000000000
    Einv[47,47]=0.0775000000000000
    Einv[48,48]=1
    Einv[49,49]=1
    Einv[50,50]=0.0775000000000000
    Einv[51,51]=0.0775000000000000
    Einv[52,52]=1
    Einv[53,53]=1
    Einv[54,54]=0.0775000000000000
    Einv[55,55]=0.0775000000000000
    Einv[56,56]=1
    Einv[57,57]=1
    Einv[58,58]=0.0775000000000000
    Einv[59,59]=0.0775000000000000
    Einv[60,60]=1
    Einv[61,61]=1
    Einv[62,62]=0.0775000000000000
    Einv[63,63]=0.0775000000000000
    Einv[64,64]=1
    Einv[65,65]=1
    Einv[66,66]=0.0775000000000000
    Einv[67,67]=0.0775000000000000
    Einv[68,68]=1
    Einv[69,69]=1
    Einv[70,70]=0.0775000000000000
    Einv[71,71]=0.0775000000000000
    Einv[72,72]=1
    Einv[73,73]=1
    Einv[74,74]=0.0775000000000000
    Einv[75,75]=0.0775000000000000
    Einv[76,76]=1
    Einv[77,77]=1
    Einv[78,78]=0.0775000000000000
    Einv[79,79]=0.0775000000000000
    Einv[80,80]=1
    Einv[81,81]=1
    Einv[82,82]=0.0775000000000000
    Einv[83,83]=0.0775000000000000
    Einv[84,84]=1
    Einv[85,85]=1
    Einv[86,86]=0.0775000000000000
    Einv[87,87]=0.0775000000000000
    Einv[88,88]=1
    Einv[89,89]=1
    Einv[90,90]=0.0775000000000000
    Einv[91,91]=0.0775000000000000
    Einv[92,92]=1
    Einv[93,93]=1
    Einv[94,94]=0.0775000000000000
    Einv[95,95]=0.0775000000000000
    Einv[96,96]=1
    Einv[97,97]=1
    Einv[98,98]=0.0775000000000000
    Einv[99,99]=0.0775000000000000
    B[2,2]=1
    B[6,6]=1
    B[10,10]=1
    B[14,14]=1
    B[18,18]=1
    B[22,22]=1
    B[26,26]=1
    B[30,30]=1
    B[34,34]=1
    B[38,38]=1
    B[42,42]=1
    B[46,46]=1
    B[50,50]=1
    B[54,54]=1
    B[58,58]=1
    B[62,62]=1
    B[66,66]=1
    B[70,70]=1
    B[74,74]=1
    B[78,78]=1
    B[82,82]=1
    B[86,86]=1
    B[90,90]=1
    B[94,94]=1
    B[98,98]=1
    Bhat[2,0]=12.9032258064516
    Bhat[22,0]=12.9032258064516
    Bhat[42,0]=12.9032258064516
    Bhat[62,0]=12.9032258064516
    Bhat[82,0]=12.9032258064516
    C[2,2]=2.10000000000000
    C[2,6]=-1.20000000000000
    C[2,22]=-0.900000000000000
    C[6,2]=-1.20000000000000
    C[6,6]=3.30000000000000
    C[6,10]=-1.20000000000000
    C[6,26]=-0.900000000000000
    C[10,6]=-1.20000000000000
    C[10,10]=3.30000000000000
    C[10,14]=-1.20000000000000
    C[10,30]=-0.900000000000000
    C[14,10]=-1.20000000000000
    C[14,14]=3.30000000000000
    C[14,18]=-1.20000000000000
    C[14,34]=-0.900000000000000
    C[18,14]=-1.20000000000000
    C[18,18]=2.10000000000000
    C[18,38]=-0.900000000000000
    C[22,2]=-0.900000000000000
    C[22,22]=3.00000000000000
    C[22,26]=-1.20000000000000
    C[22,42]=-0.900000000000000
    C[26,6]=-0.900000000000000
    C[26,22]=-1.20000000000000
    C[26,26]=4.20000000000000
    C[26,30]=-1.20000000000000
    C[26,46]=-0.900000000000000
    C[30,10]=-0.900000000000000
    C[30,26]=-1.20000000000000
    C[30,30]=4.20000000000000
    C[30,34]=-1.20000000000000
    C[30,50]=-0.900000000000000
    C[34,14]=-0.900000000000000
    C[34,30]=-1.20000000000000
    C[34,34]=4.20000000000000
    C[34,38]=-1.20000000000000
    C[34,54]=-0.900000000000000
    C[38,18]=-0.900000000000000
    C[38,34]=-1.20000000000000
    C[38,38]=3.00000000000000
    C[38,58]=-0.900000000000000
    C[42,22]=-0.900000000000000
    C[42,42]=3.00000000000000
    C[42,46]=-1.20000000000000
    C[42,62]=-0.900000000000000
    C[46,26]=-0.900000000000000
    C[46,42]=-1.20000000000000
    C[46,46]=4.20000000000000
    C[46,50]=-1.20000000000000
    C[46,66]=-0.900000000000000
    C[50,30]=-0.900000000000000
    C[50,46]=-1.20000000000000
    C[50,50]=4.20000000000000
    C[50,54]=-1.20000000000000
    C[50,70]=-0.900000000000000
    C[54,34]=-0.900000000000000
    C[54,50]=-1.20000000000000
    C[54,54]=4.20000000000000
    C[54,58]=-1.20000000000000
    C[54,74]=-0.900000000000000
    C[58,38]=-0.900000000000000
    C[58,54]=-1.20000000000000
    C[58,58]=3.00000000000000
    C[58,78]=-0.900000000000000
    C[62,42]=-0.900000000000000
    C[62,62]=3.00000000000000
    C[62,66]=-1.20000000000000
    C[62,82]=-0.900000000000000
    C[66,46]=-0.900000000000000
    C[66,62]=-1.20000000000000
    C[66,66]=4.20000000000000
    C[66,70]=-1.20000000000000
    C[66,86]=-0.900000000000000
    C[70,50]=-0.900000000000000
    C[70,66]=-1.20000000000000
    C[70,70]=4.20000000000000
    C[70,74]=-1.20000000000000
    C[70,90]=-0.900000000000000
    C[74,54]=-0.900000000000000
    C[74,70]=-1.20000000000000
    C[74,74]=4.20000000000000
    C[74,78]=-1.20000000000000
    C[74,94]=-0.900000000000000
    C[78,58]=-0.900000000000000
    C[78,74]=-1.20000000000000
    C[78,78]=3.00000000000000
    C[78,98]=-0.900000000000000
    C[82,62]=-0.900000000000000
    C[82,82]=2.10000000000000
    C[82,86]=-1.20000000000000
    C[86,66]=-0.900000000000000
    C[86,82]=-1.20000000000000
    C[86,86]=3.30000000000000
    C[86,90]=-1.20000000000000
    C[90,70]=-0.900000000000000
    C[90,86]=-1.20000000000000
    C[90,90]=3.30000000000000
    C[90,94]=-1.20000000000000
    C[94,74]=-0.900000000000000
    C[94,90]=-1.20000000000000
    C[94,94]=3.30000000000000
    C[94,98]=-1.20000000000000
    C[98,78]=-0.900000000000000
    C[98,94]=-1.20000000000000
    C[98,98]=2.10000000000000

#Setup rhs
def setup_rhs(voi,states,variables):
    process_timesensitive_inputs(voi,states,variables)
    #Computing nonlinear variables
    variables[1] = states[0]*(-0.016502*Heaviside(0.2925 - states[0])*Heaviside(states[2] - 0.78) + 0.016602)
    variables[2] = -0.016502*Heaviside(0.2925 - states[0])*Heaviside(states[2] - 0.78) + 0.016602
    variables[3] = 9.28461798035093*exp(-270.806766140199*(states[2] - 1)**2)
    variables[4] = states[2]*(-states[3] - 8.0*(states[2] - 1)*(states[2] - 0.13))
    variables[5] = -(8.0*states[2]*(states[2] - 1.13) + states[3])*(0.002*states[2] + 0.2*states[3] + 0.0006)/(states[2] + 0.3)
    variables[6] = states[4]*(-0.016502*Heaviside(0.2925 - states[4])*Heaviside(states[6] - 0.78) + 0.016602)
    variables[7] = -0.016502*Heaviside(0.2925 - states[4])*Heaviside(states[6] - 0.78) + 0.016602
    variables[8] = 9.28461798035093*exp(-270.806766140199*(states[6] - 1)**2)
    variables[9] = states[6]*(-states[7] - 8.0*(states[6] - 1)*(states[6] - 0.13))
    variables[10] = -(8.0*states[6]*(states[6] - 1.13) + states[7])*(0.002*states[6] + 0.2*states[7] + 0.0006)/(states[6] + 0.3)
    variables[11] = states[8]*(-0.016502*Heaviside(0.2925 - states[8])*Heaviside(states[10] - 0.78) + 0.016602)
    variables[12] = -0.016502*Heaviside(0.2925 - states[8])*Heaviside(states[10] - 0.78) + 0.016602
    variables[13] = 9.28461798035093*exp(-270.806766140199*(states[10] - 1)**2)
    variables[14] = states[10]*(-states[11] - 8.0*(states[10] - 1)*(states[10] - 0.13))
    variables[15] = -(8.0*states[10]*(states[10] - 1.13) + states[11])*(0.002*states[10] + 0.2*states[11] + 0.0006)/(states[10] + 0.3)
    variables[16] = states[12]*(-0.016502*Heaviside(0.2925 - states[12])*Heaviside(states[14] - 0.78) + 0.016602)
    variables[17] = -0.016502*Heaviside(0.2925 - states[12])*Heaviside(states[14] - 0.78) + 0.016602
    variables[18] = 9.28461798035093*exp(-270.806766140199*(states[14] - 1)**2)
    variables[19] = states[14]*(-states[15] - 8.0*(states[14] - 1)*(states[14] - 0.13))
    variables[20] = -(8.0*states[14]*(states[14] - 1.13) + states[15])*(0.002*states[14] + 0.2*states[15] + 0.0006)/(states[14] + 0.3)
    variables[21] = states[16]*(-0.016502*Heaviside(0.2925 - states[16])*Heaviside(states[18] - 0.78) + 0.016602)
    variables[22] = -0.016502*Heaviside(0.2925 - states[16])*Heaviside(states[18] - 0.78) + 0.016602
    variables[23] = 9.28461798035093*exp(-270.806766140199*(states[18] - 1)**2)
    variables[24] = states[18]*(-states[19] - 8.0*(states[18] - 1)*(states[18] - 0.13))
    variables[25] = -(8.0*states[18]*(states[18] - 1.13) + states[19])*(0.002*states[18] + 0.2*states[19] + 0.0006)/(states[18] + 0.3)
    variables[26] = states[20]*(-0.016502*Heaviside(0.2925 - states[20])*Heaviside(states[22] - 0.78) + 0.016602)
    variables[27] = -0.016502*Heaviside(0.2925 - states[20])*Heaviside(states[22] - 0.78) + 0.016602
    variables[28] = 9.28461798035093*exp(-270.806766140199*(states[22] - 1)**2)
    variables[29] = states[22]*(-states[23] - 8.0*(states[22] - 1)*(states[22] - 0.13))
    variables[30] = -(8.0*states[22]*(states[22] - 1.13) + states[23])*(0.002*states[22] + 0.2*states[23] + 0.0006)/(states[22] + 0.3)
    variables[31] = states[24]*(-0.016502*Heaviside(0.2925 - states[24])*Heaviside(states[26] - 0.78) + 0.016602)
    variables[32] = -0.016502*Heaviside(0.2925 - states[24])*Heaviside(states[26] - 0.78) + 0.016602
    variables[33] = 9.28461798035093*exp(-270.806766140199*(states[26] - 1)**2)
    variables[34] = states[26]*(-states[27] - 8.0*(states[26] - 1)*(states[26] - 0.13))
    variables[35] = -(8.0*states[26]*(states[26] - 1.13) + states[27])*(0.002*states[26] + 0.2*states[27] + 0.0006)/(states[26] + 0.3)
    variables[36] = states[28]*(-0.016502*Heaviside(0.2925 - states[28])*Heaviside(states[30] - 0.78) + 0.016602)
    variables[37] = -0.016502*Heaviside(0.2925 - states[28])*Heaviside(states[30] - 0.78) + 0.016602
    variables[38] = 9.28461798035093*exp(-270.806766140199*(states[30] - 1)**2)
    variables[39] = states[30]*(-states[31] - 8.0*(states[30] - 1)*(states[30] - 0.13))
    variables[40] = -(8.0*states[30]*(states[30] - 1.13) + states[31])*(0.002*states[30] + 0.2*states[31] + 0.0006)/(states[30] + 0.3)
    variables[41] = states[32]*(-0.016502*Heaviside(0.2925 - states[32])*Heaviside(states[34] - 0.78) + 0.016602)
    variables[42] = -0.016502*Heaviside(0.2925 - states[32])*Heaviside(states[34] - 0.78) + 0.016602
    variables[43] = 9.28461798035093*exp(-270.806766140199*(states[34] - 1)**2)
    variables[44] = states[34]*(-states[35] - 8.0*(states[34] - 1)*(states[34] - 0.13))
    variables[45] = -(8.0*states[34]*(states[34] - 1.13) + states[35])*(0.002*states[34] + 0.2*states[35] + 0.0006)/(states[34] + 0.3)
    variables[46] = states[36]*(-0.016502*Heaviside(0.2925 - states[36])*Heaviside(states[38] - 0.78) + 0.016602)
    variables[47] = -0.016502*Heaviside(0.2925 - states[36])*Heaviside(states[38] - 0.78) + 0.016602
    variables[48] = 9.28461798035093*exp(-270.806766140199*(states[38] - 1)**2)
    variables[49] = states[38]*(-states[39] - 8.0*(states[38] - 1)*(states[38] - 0.13))
    variables[50] = -(8.0*states[38]*(states[38] - 1.13) + states[39])*(0.002*states[38] + 0.2*states[39] + 0.0006)/(states[38] + 0.3)
    variables[51] = states[40]*(-0.016502*Heaviside(0.2925 - states[40])*Heaviside(states[42] - 0.78) + 0.016602)
    variables[52] = -0.016502*Heaviside(0.2925 - states[40])*Heaviside(states[42] - 0.78) + 0.016602
    variables[53] = 9.28461798035093*exp(-270.806766140199*(states[42] - 1)**2)
    variables[54] = states[42]*(-states[43] - 8.0*(states[42] - 1)*(states[42] - 0.13))
    variables[55] = -(8.0*states[42]*(states[42] - 1.13) + states[43])*(0.002*states[42] + 0.2*states[43] + 0.0006)/(states[42] + 0.3)
    variables[56] = states[44]*(-0.016502*Heaviside(0.2925 - states[44])*Heaviside(states[46] - 0.78) + 0.016602)
    variables[57] = -0.016502*Heaviside(0.2925 - states[44])*Heaviside(states[46] - 0.78) + 0.016602
    variables[58] = 9.28461798035093*exp(-270.806766140199*(states[46] - 1)**2)
    variables[59] = states[46]*(-states[47] - 8.0*(states[46] - 1)*(states[46] - 0.13))
    variables[60] = -(8.0*states[46]*(states[46] - 1.13) + states[47])*(0.002*states[46] + 0.2*states[47] + 0.0006)/(states[46] + 0.3)
    variables[61] = states[48]*(-0.016502*Heaviside(0.2925 - states[48])*Heaviside(states[50] - 0.78) + 0.016602)
    variables[62] = -0.016502*Heaviside(0.2925 - states[48])*Heaviside(states[50] - 0.78) + 0.016602
    variables[63] = 9.28461798035093*exp(-270.806766140199*(states[50] - 1)**2)
    variables[64] = states[50]*(-states[51] - 8.0*(states[50] - 1)*(states[50] - 0.13))
    variables[65] = -(8.0*states[50]*(states[50] - 1.13) + states[51])*(0.002*states[50] + 0.2*states[51] + 0.0006)/(states[50] + 0.3)
    variables[66] = states[52]*(-0.016502*Heaviside(0.2925 - states[52])*Heaviside(states[54] - 0.78) + 0.016602)
    variables[67] = -0.016502*Heaviside(0.2925 - states[52])*Heaviside(states[54] - 0.78) + 0.016602
    variables[68] = 9.28461798035093*exp(-270.806766140199*(states[54] - 1)**2)
    variables[69] = states[54]*(-states[55] - 8.0*(states[54] - 1)*(states[54] - 0.13))
    variables[70] = -(8.0*states[54]*(states[54] - 1.13) + states[55])*(0.002*states[54] + 0.2*states[55] + 0.0006)/(states[54] + 0.3)
    variables[71] = states[56]*(-0.016502*Heaviside(0.2925 - states[56])*Heaviside(states[58] - 0.78) + 0.016602)
    variables[72] = -0.016502*Heaviside(0.2925 - states[56])*Heaviside(states[58] - 0.78) + 0.016602
    variables[73] = 9.28461798035093*exp(-270.806766140199*(states[58] - 1)**2)
    variables[74] = states[58]*(-states[59] - 8.0*(states[58] - 1)*(states[58] - 0.13))
    variables[75] = -(8.0*states[58]*(states[58] - 1.13) + states[59])*(0.002*states[58] + 0.2*states[59] + 0.0006)/(states[58] + 0.3)
    variables[76] = states[60]*(-0.016502*Heaviside(0.2925 - states[60])*Heaviside(states[62] - 0.78) + 0.016602)
    variables[77] = -0.016502*Heaviside(0.2925 - states[60])*Heaviside(states[62] - 0.78) + 0.016602
    variables[78] = 9.28461798035093*exp(-270.806766140199*(states[62] - 1)**2)
    variables[79] = states[62]*(-states[63] - 8.0*(states[62] - 1)*(states[62] - 0.13))
    variables[80] = -(8.0*states[62]*(states[62] - 1.13) + states[63])*(0.002*states[62] + 0.2*states[63] + 0.0006)/(states[62] + 0.3)
    variables[81] = states[64]*(-0.016502*Heaviside(0.2925 - states[64])*Heaviside(states[66] - 0.78) + 0.016602)
    variables[82] = -0.016502*Heaviside(0.2925 - states[64])*Heaviside(states[66] - 0.78) + 0.016602
    variables[83] = 9.28461798035093*exp(-270.806766140199*(states[66] - 1)**2)
    variables[84] = states[66]*(-states[67] - 8.0*(states[66] - 1)*(states[66] - 0.13))
    variables[85] = -(8.0*states[66]*(states[66] - 1.13) + states[67])*(0.002*states[66] + 0.2*states[67] + 0.0006)/(states[66] + 0.3)
    variables[86] = states[68]*(-0.016502*Heaviside(0.2925 - states[68])*Heaviside(states[70] - 0.78) + 0.016602)
    variables[87] = -0.016502*Heaviside(0.2925 - states[68])*Heaviside(states[70] - 0.78) + 0.016602
    variables[88] = 9.28461798035093*exp(-270.806766140199*(states[70] - 1)**2)
    variables[89] = states[70]*(-states[71] - 8.0*(states[70] - 1)*(states[70] - 0.13))
    variables[90] = -(8.0*states[70]*(states[70] - 1.13) + states[71])*(0.002*states[70] + 0.2*states[71] + 0.0006)/(states[70] + 0.3)
    variables[91] = states[72]*(-0.016502*Heaviside(0.2925 - states[72])*Heaviside(states[74] - 0.78) + 0.016602)
    variables[92] = -0.016502*Heaviside(0.2925 - states[72])*Heaviside(states[74] - 0.78) + 0.016602
    variables[93] = 9.28461798035093*exp(-270.806766140199*(states[74] - 1)**2)
    variables[94] = states[74]*(-states[75] - 8.0*(states[74] - 1)*(states[74] - 0.13))
    variables[95] = -(8.0*states[74]*(states[74] - 1.13) + states[75])*(0.002*states[74] + 0.2*states[75] + 0.0006)/(states[74] + 0.3)
    variables[96] = states[76]*(-0.016502*Heaviside(0.2925 - states[76])*Heaviside(states[78] - 0.78) + 0.016602)
    variables[97] = -0.016502*Heaviside(0.2925 - states[76])*Heaviside(states[78] - 0.78) + 0.016602
    variables[98] = 9.28461798035093*exp(-270.806766140199*(states[78] - 1)**2)
    variables[99] = states[78]*(-states[79] - 8.0*(states[78] - 1)*(states[78] - 0.13))
    variables[100] = -(8.0*states[78]*(states[78] - 1.13) + states[79])*(0.002*states[78] + 0.2*states[79] + 0.0006)/(states[78] + 0.3)
    variables[101] = states[80]*(-0.016502*Heaviside(0.2925 - states[80])*Heaviside(states[82] - 0.78) + 0.016602)
    variables[102] = -0.016502*Heaviside(0.2925 - states[80])*Heaviside(states[82] - 0.78) + 0.016602
    variables[103] = 9.28461798035093*exp(-270.806766140199*(states[82] - 1)**2)
    variables[104] = states[82]*(-states[83] - 8.0*(states[82] - 1)*(states[82] - 0.13))
    variables[105] = -(8.0*states[82]*(states[82] - 1.13) + states[83])*(0.002*states[82] + 0.2*states[83] + 0.0006)/(states[82] + 0.3)
    variables[106] = states[84]*(-0.016502*Heaviside(0.2925 - states[84])*Heaviside(states[86] - 0.78) + 0.016602)
    variables[107] = -0.016502*Heaviside(0.2925 - states[84])*Heaviside(states[86] - 0.78) + 0.016602
    variables[108] = 9.28461798035093*exp(-270.806766140199*(states[86] - 1)**2)
    variables[109] = states[86]*(-states[87] - 8.0*(states[86] - 1)*(states[86] - 0.13))
    variables[110] = -(8.0*states[86]*(states[86] - 1.13) + states[87])*(0.002*states[86] + 0.2*states[87] + 0.0006)/(states[86] + 0.3)
    variables[111] = states[88]*(-0.016502*Heaviside(0.2925 - states[88])*Heaviside(states[90] - 0.78) + 0.016602)
    variables[112] = -0.016502*Heaviside(0.2925 - states[88])*Heaviside(states[90] - 0.78) + 0.016602
    variables[113] = 9.28461798035093*exp(-270.806766140199*(states[90] - 1)**2)
    variables[114] = states[90]*(-states[91] - 8.0*(states[90] - 1)*(states[90] - 0.13))
    variables[115] = -(8.0*states[90]*(states[90] - 1.13) + states[91])*(0.002*states[90] + 0.2*states[91] + 0.0006)/(states[90] + 0.3)
    variables[116] = states[92]*(-0.016502*Heaviside(0.2925 - states[92])*Heaviside(states[94] - 0.78) + 0.016602)
    variables[117] = -0.016502*Heaviside(0.2925 - states[92])*Heaviside(states[94] - 0.78) + 0.016602
    variables[118] = 9.28461798035093*exp(-270.806766140199*(states[94] - 1)**2)
    variables[119] = states[94]*(-states[95] - 8.0*(states[94] - 1)*(states[94] - 0.13))
    variables[120] = -(8.0*states[94]*(states[94] - 1.13) + states[95])*(0.002*states[94] + 0.2*states[95] + 0.0006)/(states[94] + 0.3)
    variables[121] = states[96]*(-0.016502*Heaviside(0.2925 - states[96])*Heaviside(states[98] - 0.78) + 0.016602)
    variables[122] = -0.016502*Heaviside(0.2925 - states[96])*Heaviside(states[98] - 0.78) + 0.016602
    variables[123] = 9.28461798035093*exp(-270.806766140199*(states[98] - 1)**2)
    variables[124] = states[98]*(-states[99] - 8.0*(states[98] - 1)*(states[98] - 0.13))
    variables[125] = -(8.0*states[98]*(states[98] - 1.13) + states[99])*(0.002*states[98] + 0.2*states[99] + 0.0006)/(states[98] + 0.3)

    #Variable PHS matrix entries
    J[0,1]=-variables[1]/2
    J[0,2]=0.008301*variables[3]/states[2]
    J[1,0]=variables[1]/(2*states[0])
    J[2,0]=-0.008301*variables[3]
    J[4,5]=-variables[6]/2
    J[4,6]=0.008301*variables[8]/states[6]
    J[5,4]=variables[6]/(2*states[4])
    J[6,4]=-0.008301*variables[8]
    J[8,9]=-variables[11]/2
    J[8,10]=0.008301*variables[13]/states[10]
    J[9,8]=variables[11]/(2*states[8])
    J[10,8]=-0.008301*variables[13]
    J[12,13]=-variables[16]/2
    J[12,14]=0.008301*variables[18]/states[14]
    J[13,12]=variables[16]/(2*states[12])
    J[14,12]=-0.008301*variables[18]
    J[16,17]=-variables[21]/2
    J[16,18]=0.008301*variables[23]/states[18]
    J[17,16]=variables[21]/(2*states[16])
    J[18,16]=-0.008301*variables[23]
    J[20,21]=-variables[26]/2
    J[20,22]=0.008301*variables[28]/states[22]
    J[21,20]=variables[26]/(2*states[20])
    J[22,20]=-0.008301*variables[28]
    J[24,25]=-variables[31]/2
    J[24,26]=0.008301*variables[33]/states[26]
    J[25,24]=variables[31]/(2*states[24])
    J[26,24]=-0.008301*variables[33]
    J[28,29]=-variables[36]/2
    J[28,30]=0.008301*variables[38]/states[30]
    J[29,28]=variables[36]/(2*states[28])
    J[30,28]=-0.008301*variables[38]
    J[32,33]=-variables[41]/2
    J[32,34]=0.008301*variables[43]/states[34]
    J[33,32]=variables[41]/(2*states[32])
    J[34,32]=-0.008301*variables[43]
    J[36,37]=-variables[46]/2
    J[36,38]=0.008301*variables[48]/states[38]
    J[37,36]=variables[46]/(2*states[36])
    J[38,36]=-0.008301*variables[48]
    J[40,41]=-variables[51]/2
    J[40,42]=0.008301*variables[53]/states[42]
    J[41,40]=variables[51]/(2*states[40])
    J[42,40]=-0.008301*variables[53]
    J[44,45]=-variables[56]/2
    J[44,46]=0.008301*variables[58]/states[46]
    J[45,44]=variables[56]/(2*states[44])
    J[46,44]=-0.008301*variables[58]
    J[48,49]=-variables[61]/2
    J[48,50]=0.008301*variables[63]/states[50]
    J[49,48]=variables[61]/(2*states[48])
    J[50,48]=-0.008301*variables[63]
    J[52,53]=-variables[66]/2
    J[52,54]=0.008301*variables[68]/states[54]
    J[53,52]=variables[66]/(2*states[52])
    J[54,52]=-0.008301*variables[68]
    J[56,57]=-variables[71]/2
    J[56,58]=0.008301*variables[73]/states[58]
    J[57,56]=variables[71]/(2*states[56])
    J[58,56]=-0.008301*variables[73]
    J[60,61]=-variables[76]/2
    J[60,62]=0.008301*variables[78]/states[62]
    J[61,60]=variables[76]/(2*states[60])
    J[62,60]=-0.008301*variables[78]
    J[64,65]=-variables[81]/2
    J[64,66]=0.008301*variables[83]/states[66]
    J[65,64]=variables[81]/(2*states[64])
    J[66,64]=-0.008301*variables[83]
    J[68,69]=-variables[86]/2
    J[68,70]=0.008301*variables[88]/states[70]
    J[69,68]=variables[86]/(2*states[68])
    J[70,68]=-0.008301*variables[88]
    J[72,73]=-variables[91]/2
    J[72,74]=0.008301*variables[93]/states[74]
    J[73,72]=variables[91]/(2*states[72])
    J[74,72]=-0.008301*variables[93]
    J[76,77]=-variables[96]/2
    J[76,78]=0.008301*variables[98]/states[78]
    J[77,76]=variables[96]/(2*states[76])
    J[78,76]=-0.008301*variables[98]
    J[80,81]=-variables[101]/2
    J[80,82]=0.008301*variables[103]/states[82]
    J[81,80]=variables[101]/(2*states[80])
    J[82,80]=-0.008301*variables[103]
    J[84,85]=-variables[106]/2
    J[84,86]=0.008301*variables[108]/states[86]
    J[85,84]=variables[106]/(2*states[84])
    J[86,84]=-0.008301*variables[108]
    J[88,89]=-variables[111]/2
    J[88,90]=0.008301*variables[113]/states[90]
    J[89,88]=variables[111]/(2*states[88])
    J[90,88]=-0.008301*variables[113]
    J[92,93]=-variables[116]/2
    J[92,94]=0.008301*variables[118]/states[94]
    J[93,92]=variables[116]/(2*states[92])
    J[94,92]=-0.008301*variables[118]
    J[96,97]=-variables[121]/2
    J[96,98]=0.008301*variables[123]/states[98]
    J[97,96]=variables[121]/(2*states[96])
    J[98,96]=-0.008301*variables[123]
    R[0,1]=-variables[1]/2
    R[0,2]=-0.008301*variables[3]/states[2]
    R[1,0]=-variables[1]/(2*states[0])
    R[1,1]=variables[2]
    R[2,0]=-0.008301*variables[3]
    R[2,2]=-variables[4]/states[2]
    R[3,3]=-variables[5]/states[3]
    R[4,5]=-variables[6]/2
    R[4,6]=-0.008301*variables[8]/states[6]
    R[5,4]=-variables[6]/(2*states[4])
    R[5,5]=variables[7]
    R[6,4]=-0.008301*variables[8]
    R[6,6]=-variables[9]/states[6]
    R[7,7]=-variables[10]/states[7]
    R[8,9]=-variables[11]/2
    R[8,10]=-0.008301*variables[13]/states[10]
    R[9,8]=-variables[11]/(2*states[8])
    R[9,9]=variables[12]
    R[10,8]=-0.008301*variables[13]
    R[10,10]=-variables[14]/states[10]
    R[11,11]=-variables[15]/states[11]
    R[12,13]=-variables[16]/2
    R[12,14]=-0.008301*variables[18]/states[14]
    R[13,12]=-variables[16]/(2*states[12])
    R[13,13]=variables[17]
    R[14,12]=-0.008301*variables[18]
    R[14,14]=-variables[19]/states[14]
    R[15,15]=-variables[20]/states[15]
    R[16,17]=-variables[21]/2
    R[16,18]=-0.008301*variables[23]/states[18]
    R[17,16]=-variables[21]/(2*states[16])
    R[17,17]=variables[22]
    R[18,16]=-0.008301*variables[23]
    R[18,18]=-variables[24]/states[18]
    R[19,19]=-variables[25]/states[19]
    R[20,21]=-variables[26]/2
    R[20,22]=-0.008301*variables[28]/states[22]
    R[21,20]=-variables[26]/(2*states[20])
    R[21,21]=variables[27]
    R[22,20]=-0.008301*variables[28]
    R[22,22]=-variables[29]/states[22]
    R[23,23]=-variables[30]/states[23]
    R[24,25]=-variables[31]/2
    R[24,26]=-0.008301*variables[33]/states[26]
    R[25,24]=-variables[31]/(2*states[24])
    R[25,25]=variables[32]
    R[26,24]=-0.008301*variables[33]
    R[26,26]=-variables[34]/states[26]
    R[27,27]=-variables[35]/states[27]
    R[28,29]=-variables[36]/2
    R[28,30]=-0.008301*variables[38]/states[30]
    R[29,28]=-variables[36]/(2*states[28])
    R[29,29]=variables[37]
    R[30,28]=-0.008301*variables[38]
    R[30,30]=-variables[39]/states[30]
    R[31,31]=-variables[40]/states[31]
    R[32,33]=-variables[41]/2
    R[32,34]=-0.008301*variables[43]/states[34]
    R[33,32]=-variables[41]/(2*states[32])
    R[33,33]=variables[42]
    R[34,32]=-0.008301*variables[43]
    R[34,34]=-variables[44]/states[34]
    R[35,35]=-variables[45]/states[35]
    R[36,37]=-variables[46]/2
    R[36,38]=-0.008301*variables[48]/states[38]
    R[37,36]=-variables[46]/(2*states[36])
    R[37,37]=variables[47]
    R[38,36]=-0.008301*variables[48]
    R[38,38]=-variables[49]/states[38]
    R[39,39]=-variables[50]/states[39]
    R[40,41]=-variables[51]/2
    R[40,42]=-0.008301*variables[53]/states[42]
    R[41,40]=-variables[51]/(2*states[40])
    R[41,41]=variables[52]
    R[42,40]=-0.008301*variables[53]
    R[42,42]=-variables[54]/states[42]
    R[43,43]=-variables[55]/states[43]
    R[44,45]=-variables[56]/2
    R[44,46]=-0.008301*variables[58]/states[46]
    R[45,44]=-variables[56]/(2*states[44])
    R[45,45]=variables[57]
    R[46,44]=-0.008301*variables[58]
    R[46,46]=-variables[59]/states[46]
    R[47,47]=-variables[60]/states[47]
    R[48,49]=-variables[61]/2
    R[48,50]=-0.008301*variables[63]/states[50]
    R[49,48]=-variables[61]/(2*states[48])
    R[49,49]=variables[62]
    R[50,48]=-0.008301*variables[63]
    R[50,50]=-variables[64]/states[50]
    R[51,51]=-variables[65]/states[51]
    R[52,53]=-variables[66]/2
    R[52,54]=-0.008301*variables[68]/states[54]
    R[53,52]=-variables[66]/(2*states[52])
    R[53,53]=variables[67]
    R[54,52]=-0.008301*variables[68]
    R[54,54]=-variables[69]/states[54]
    R[55,55]=-variables[70]/states[55]
    R[56,57]=-variables[71]/2
    R[56,58]=-0.008301*variables[73]/states[58]
    R[57,56]=-variables[71]/(2*states[56])
    R[57,57]=variables[72]
    R[58,56]=-0.008301*variables[73]
    R[58,58]=-variables[74]/states[58]
    R[59,59]=-variables[75]/states[59]
    R[60,61]=-variables[76]/2
    R[60,62]=-0.008301*variables[78]/states[62]
    R[61,60]=-variables[76]/(2*states[60])
    R[61,61]=variables[77]
    R[62,60]=-0.008301*variables[78]
    R[62,62]=-variables[79]/states[62]
    R[63,63]=-variables[80]/states[63]
    R[64,65]=-variables[81]/2
    R[64,66]=-0.008301*variables[83]/states[66]
    R[65,64]=-variables[81]/(2*states[64])
    R[65,65]=variables[82]
    R[66,64]=-0.008301*variables[83]
    R[66,66]=-variables[84]/states[66]
    R[67,67]=-variables[85]/states[67]
    R[68,69]=-variables[86]/2
    R[68,70]=-0.008301*variables[88]/states[70]
    R[69,68]=-variables[86]/(2*states[68])
    R[69,69]=variables[87]
    R[70,68]=-0.008301*variables[88]
    R[70,70]=-variables[89]/states[70]
    R[71,71]=-variables[90]/states[71]
    R[72,73]=-variables[91]/2
    R[72,74]=-0.008301*variables[93]/states[74]
    R[73,72]=-variables[91]/(2*states[72])
    R[73,73]=variables[92]
    R[74,72]=-0.008301*variables[93]
    R[74,74]=-variables[94]/states[74]
    R[75,75]=-variables[95]/states[75]
    R[76,77]=-variables[96]/2
    R[76,78]=-0.008301*variables[98]/states[78]
    R[77,76]=-variables[96]/(2*states[76])
    R[77,77]=variables[97]
    R[78,76]=-0.008301*variables[98]
    R[78,78]=-variables[99]/states[78]
    R[79,79]=-variables[100]/states[79]
    R[80,81]=-variables[101]/2
    R[80,82]=-0.008301*variables[103]/states[82]
    R[81,80]=-variables[101]/(2*states[80])
    R[81,81]=variables[102]
    R[82,80]=-0.008301*variables[103]
    R[82,82]=-variables[104]/states[82]
    R[83,83]=-variables[105]/states[83]
    R[84,85]=-variables[106]/2
    R[84,86]=-0.008301*variables[108]/states[86]
    R[85,84]=-variables[106]/(2*states[84])
    R[85,85]=variables[107]
    R[86,84]=-0.008301*variables[108]
    R[86,86]=-variables[109]/states[86]
    R[87,87]=-variables[110]/states[87]
    R[88,89]=-variables[111]/2
    R[88,90]=-0.008301*variables[113]/states[90]
    R[89,88]=-variables[111]/(2*states[88])
    R[89,89]=variables[112]
    R[90,88]=-0.008301*variables[113]
    R[90,90]=-variables[114]/states[90]
    R[91,91]=-variables[115]/states[91]
    R[92,93]=-variables[116]/2
    R[92,94]=-0.008301*variables[118]/states[94]
    R[93,92]=-variables[116]/(2*states[92])
    R[93,93]=variables[117]
    R[94,92]=-0.008301*variables[118]
    R[94,94]=-variables[119]/states[94]
    R[95,95]=-variables[120]/states[95]
    R[96,97]=-variables[121]/2
    R[96,98]=-0.008301*variables[123]/states[98]
    R[97,96]=-variables[121]/(2*states[96])
    R[97,97]=variables[122]
    R[98,96]=-0.008301*variables[123]
    R[98,98]=-variables[124]/states[98]
    R[99,99]=-variables[125]/states[99]


#Compute rhs
def compute_rhs(voi,states,variables):
    setup_rhs(voi,states,variables)
    return Einv@((J-R)@Q@states - B@C@(B.T)@states + Bhat@variables[:1])
#solve a step rhs
def process_timesensitive_inputs(voi,states,variables):
    #Input variables
    variables[0] = 0.0 #i_1_2

    if voi > 100.0 and voi < 120.0:
        variables[0] = 0.5

def compute_reduced_rhs(voi,states,variables):
    #Map reduced states to full states
    full_states = R2F@states
    setup_rhs(voi,full_states,variables)
    #reduced matrices
    Erd = (Er.T)@Einv@Er
    Qrd = (Qr.T)@Q@Qr
    Jrd = (Jr.T)@J@Jr
    Rrd = (Rr.T)@R@Rr
    Crd = (Cr.T)@C@Cr
    Brd = (Br.T)@B@Br
    Bhrd = (Bhatr.T)@Bhat
    return Erd@((Jrd-Rrd)@Qrd@states - Brd@Crd@(Brd.T)@states + Bhrd@variables[:1])


def solve_model(starttime=0,stoptime=300,steps=300):
    """Solve model with ODE solver"""
    # Initialise constants and state variables
    states = create_states_array()
    variables = create_variables_array()
    initialise_variables(states,variables)
    # Set timespan to solve over
    voi = np.linspace(starttime, stoptime, steps)

    # Construct ODE object to solve
    r = ode(compute_rhs)
    r.set_integrator('vode', method='bdf', atol=1e-06, rtol=1e-06, max_step=1)
    r.set_initial_value(states, voi[0])
    r.set_f_params(variables)

    # Solve model
    result = np.zeros((STATE_COUNT,steps))
    result[:,0] = states    
    for (i,t) in enumerate(voi[1:]):
        if r.successful():
            r.integrate(t)
            result[:,i+1] = r.y
            states = r.y
        else:
            break

    return voi, result

def reduced_solve_model(starttime=0,stoptime=300,steps=300):
    """Solve reduced model with ODE solver"""
    # Initialise constants and state variables
    full_states = create_states_array()
    variables = create_variables_array()
    initialise_variables(full_states,variables)
    states = (Ict.T)@full_states
    # Set timespan to solve over
    voi = np.linspace(starttime, stoptime, steps)

    # Construct ODE object to solve
    r = ode(compute_reduced_rhs)
    r.set_integrator('vode', method='bdf', atol=1e-06, rtol=1e-06, max_step=1)
    r.set_initial_value(states, voi[0])
    r.set_f_params(variables)

    # Solve model
    result = np.zeros((states.shape[0],steps))
    result[:,0] = states    
    for (i,t) in enumerate(voi[1:]):
        if r.successful():
            r.integrate(t)
            result[:,i+1] = r.y
            states = r.y
        else:
            break

    return voi, result


import matplotlib.pyplot as plt
def full_model(plot=False):
    t,r = solve_model()
    if plot:
        U = r.reshape((25,4,-1))[:,2,:].squeeze()
        grid = plt.GridSpec(5, 5, wspace=0.2, hspace=0.5)

        ix = 0
        for i in range(5):
            for j in range(5):
                ax = plt.subplot(grid[i, j])
                ax.plot(U[ix,:])
                ax.title.set_text(f'{ix+1}')
                ix += 1
                if ix+1 > U.shape[0]:
                    break
        plt.subplots_adjust(hspace=0.3)
        plt.subplots_adjust(wspace=0.3)
        plt.show()      
    return t,r
        
def reduced_model(params = np.random.rand(PARAMETER_COUNT),plot=False):
    #Initialize reduction parameters    
    setReductionParameters(params)
    t,r = reduced_solve_model()
    if plot:
        U = r.reshape((5,4,-1))[:,2,:].squeeze()
        grid = plt.GridSpec(5, 1, wspace=0.2, hspace=0.5)

        ix = 0
        for i in range(5):
            ax = plt.subplot(grid[i, 0])
            ax.plot(U[ix,:])
            ax.title.set_text(f'{ix+1}')
            ix += 1
            if ix+1 > U.shape[0]:
                break
        plt.subplots_adjust(hspace=0.3)
        plt.subplots_adjust(wspace=0.3)
        plt.show()         
    return t,r
        
if __name__ == '__main__':
    np.random.seed(0)
    reduced_model(plot=True)
        
